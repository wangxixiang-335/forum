import{d as nt,c as y,r as c,i as it,w as rt,a,b as e,g as b,l as U,p as B,q as dt,j as u,F as j,h as z,t as i,n as $,u as ct,f as I,v as O,e as G,o as l,m as ut,_ as vt}from"./index-02sh5J2l.js";import{u as mt}from"./bookmarks-DOOoFvsV.js";const _t={class:"bookmarks-view"},ft={class:"header"},kt={class:"container"},bt={class:"header-content"},pt={class:"main"},gt={class:"container"},ht={class:"bookmarks-layout"},yt={class:"bookmarks-sidebar"},Ct={class:"sidebar-header"},wt={class:"folders-list"},Bt=["onClick"],$t={class:"folder-count"},xt={class:"bookmarks-content"},Vt={class:"content-header"},Ft={class:"content-actions"},Nt={key:0,class:"loading-container"},Mt={key:1,class:"bookmarks-list"},Dt={key:0,class:"bookmark-checkbox"},St=["checked","onChange"],Tt={class:"bookmark-content"},At={key:0,class:"bookmark-post"},Lt={class:"bookmark-title"},Et={key:1,class:"deleted-post"},Rt={class:"bookmark-excerpt"},qt={class:"bookmark-meta"},Ut={class:"bookmark-stats"},jt={class:"bookmark-time"},zt={key:1,class:"bookmark-comment"},It={class:"bookmark-excerpt"},Ot={class:"bookmark-meta"},Gt={class:"bookmark-post-link"},Ht={key:0},Jt={key:1,class:"deleted-post"},Kt={class:"bookmark-time"},Pt={key:2,class:"bookmark-note"},Qt={class:"bookmark-actions"},Wt=["onClick"],Xt=["onClick"],Yt={key:2,class:"empty-state"},Zt={class:"modal-header"},te={class:"modal-body"},ee={class:"mb-3"},se={class:"modal-footer"},oe=["disabled"],le={class:"modal-header"},ae={class:"modal-body"},ne={class:"mb-3"},ie={class:"modal-footer"},re=nt({__name:"BookmarksView",setup(de){const C=mt(),{isLoading:H,fetchBookmarks:ce,fetchFolders:x,removeBookmark:V,updateBookmarkNote:J,createFolder:K,fetchAllFolderCounts:ue,fetchAllUserBookmarks:g}=C,P=y(()=>C.bookmarks),v=y(()=>C.folders),r=c("默认收藏夹"),d=c([]),m=c(!1),_=c(!1),f=c(!1),k=c(""),h=c(""),F=c(""),p=c({}),Q=c(!1),W=y(()=>{const s={};return Object.assign(s,p.value),v.value&&Array.isArray(v.value)&&v.value.forEach(t=>{t in s||(s[t]=0)}),console.log("BookmarksView: folderCounts",s),s}),N=y(()=>{const s=P.value;if(console.log("BookmarksView: bookmarks.value",s),!s||!Array.isArray(s))return console.log("BookmarksView: bookmarks.value 为空或不是数组",s),[];console.log("BookmarksView: 当前收藏夹:",r.value),console.log("BookmarksView: 所有收藏数据:",s),s.forEach((n,o)=>{console.log(`收藏记录 ${o+1}:`,{id:n.id,folder_name:n.folder_name,folder_name_type:typeof n.folder_name,folder_name_length:n.folder_name?n.folder_name.length:0,currentFolder:r.value,match:n.folder_name===r.value})});const t=s.filter(n=>{const o=n.folder_name===r.value;return console.log(`比较: "${n.folder_name}" === "${r.value}" = ${o}`),o});return console.log("BookmarksView: 过滤后的收藏:",t),t}),X=s=>{console.log("BookmarksView: 切换到收藏夹:",s),r.value=s,d.value=[],m.value=!1},Y=s=>{const t=W.value[s]||0;return console.log(`getFolderCount: 收藏夹 "${s}" 的数量: ${t}`),t},Z=()=>{m.value=!m.value,m.value||(d.value=[])},tt=s=>{const t=d.value.indexOf(s);t>-1?d.value.splice(t,1):d.value.push(s)},et=async()=>{if(confirm(`确定要删除选中的 ${d.value.length} 个收藏吗？`))try{for(const t of d.value)await V(t);d.value=[],m.value=!1;const s=await g();s.success&&(p.value=s.folderCounts)}catch(s){console.error("批量删除失败:",s),alert("删除失败，请稍后重试")}},st=async s=>{if(!confirm("确定要删除这个收藏吗？"))return;const t=await V(s);if(t.success){const n=await g();n.success&&(p.value=n.folderCounts)}else alert("删除失败："+(t.error||"未知错误"))},ot=s=>{F.value=s.id,h.value=s.note||"",f.value=!0},lt=async()=>{const s=await J(F.value,h.value);if(s.success){f.value=!1;const t=await g();t.success&&(p.value=t.folderCounts)}else alert("保存失败："+(s.error||"未知错误"))},at=async()=>{if(!k.value.trim())return;const s=await K(k.value.trim());s.success?(await x(),k.value="",_.value=!1):alert("创建失败："+(s.error||"未知错误"))},M=(s,t)=>s.length<=t?s:s.substring(0,t)+"...",D=s=>{const t=new Date(s),o=new Date().getTime()-t.getTime();return o<864e5?"今天":o<6048e5?`${Math.floor(o/864e5)}天前`:t.toLocaleDateString("zh-CN")};return it(async()=>{await x();const s=await g();s.success&&(p.value=s.folderCounts,Q.value=!0,console.log("BookmarksView: onMounted 获取到的收藏数据:",s.data),v.value&&v.value.length>0&&(r.value=v.value[0],console.log("BookmarksView: 设置当前收藏夹为:",r.value)))}),rt(v,s=>{s.includes(r.value)||(r.value=s[0]||"默认收藏夹")}),(s,t)=>{const n=dt("RouterLink");return l(),a("div",_t,[e("header",ft,[e("div",kt,[e("div",bt,[U(n,{to:"/",class:"back-link"},{default:B(()=>[...t[11]||(t[11]=[e("i",{class:"bi bi-arrow-left"},null,-1),u(" 返回首页 ",-1)])]),_:1}),t[12]||(t[12]=e("h1",{class:"page-title"},"我的收藏",-1))])])]),e("main",pt,[e("div",gt,[e("div",ht,[e("aside",yt,[e("div",Ct,[t[14]||(t[14]=e("h5",null,"收藏夹",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:t[0]||(t[0]=o=>_.value=!0)},[...t[13]||(t[13]=[e("i",{class:"bi bi-plus"},null,-1),u(" 新建 ",-1)])])]),e("div",wt,[(l(!0),a(j,null,z(v.value,o=>(l(),a("div",{key:o,class:$(["folder-item",{active:r.value===o}]),onClick:w=>X(o)},[t[15]||(t[15]=e("i",{class:"bi bi-folder"},null,-1)),e("span",null,i(o),1),e("span",$t,"("+i(Y(o))+")",1)],10,Bt))),128))])]),e("section",xt,[e("div",Vt,[e("h2",null,i(r.value),1),e("div",Ft,[d.value.length>0?(l(),a("button",{key:0,class:"btn btn-sm btn-danger",onClick:et},[t[16]||(t[16]=e("i",{class:"bi bi-trash"},null,-1)),u(" 删除选中 ("+i(d.value.length)+") ",1)])):b("",!0),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:Z},[e("i",{class:$(["bi",m.value?"bi-x-square":"bi-check-square"])},null,2),u(" "+i(m.value?"取消选择":"批量管理"),1)])])]),ct(H)?(l(),a("div",Nt,[...t[17]||(t[17]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"加载中...")],-1),e("p",null,"加载收藏中...",-1)])])):N.value.length>0?(l(),a("div",Mt,[(l(!0),a(j,null,z(N.value,o=>{var w,S,T,A,L,E,R;return l(),a("div",{key:o.id,class:$(["bookmark-item",{selected:d.value.includes(o.id)}])},[m.value?(l(),a("div",Dt,[e("input",{type:"checkbox",checked:d.value.includes(o.id),onChange:q=>tt(o.id)},null,40,St)])):b("",!0),e("div",Tt,[o.target_type==="post"?(l(),a("div",At,[e("h3",Lt,[o.target_data&&o.target_data.title&&!o.target_data.title.includes("已删除")&&!o.target_data.title.includes("加载失败")?(l(),ut(n,{key:0,to:`/post/${o.target_id}`},{default:B(()=>[u(i(o.target_data.title),1)]),_:2},1032,["to"])):(l(),a("span",Et,i(((w=o.target_data)==null?void 0:w.title)||"帖子已被删除"),1))]),e("p",Rt,i(M(((S=o.target_data)==null?void 0:S.content)||"此帖子已被删除，但收藏记录保留",150)),1),e("div",qt,[e("span",Ut,[t[18]||(t[18]=e("i",{class:"bi bi-heart"},null,-1)),u(" "+i(((T=o.target_data)==null?void 0:T.like_count)||0)+" ",1),t[19]||(t[19]=e("i",{class:"bi bi-chat"},null,-1)),u(" "+i(((A=o.target_data)==null?void 0:A.comment_count)||0),1)]),e("span",jt," 收藏于 "+i(D(o.created_at)),1)])])):o.target_type==="comment"?(l(),a("div",zt,[e("p",It,i(M(((L=o.target_data)==null?void 0:L.content)||"此评论已被删除，但收藏记录保留",200)),1),e("div",Ot,[e("span",Gt,[t[20]||(t[20]=u(" 来自帖子： ",-1)),(E=o.target_data)!=null&&E.post_title?(l(),a("span",Ht,[U(n,{to:`/post/${(R=o.target_data)==null?void 0:R.post_id}`},{default:B(()=>[u(i(o.target_data.post_title),1)]),_:2},1032,["to"])])):(l(),a("span",Jt," 原帖子已被删除 "))]),e("span",Kt," 收藏于 "+i(D(o.created_at)),1)])])):b("",!0),o.note?(l(),a("div",Pt,[t[21]||(t[21]=e("i",{class:"bi bi-sticky"},null,-1)),u(" "+i(o.note),1)])):b("",!0)]),e("div",Qt,[e("button",{class:"btn btn-sm btn-outline-primary action-btn",onClick:q=>ot(o),title:"编辑备注"},[...t[22]||(t[22]=[e("i",{class:"bi bi-pencil"},null,-1),e("span",{class:"action-text"},"编辑",-1)])],8,Wt),e("button",{class:"btn btn-sm btn-outline-danger action-btn",onClick:q=>st(o.id),title:"删除收藏"},[...t[23]||(t[23]=[e("i",{class:"bi bi-trash"},null,-1),e("span",{class:"action-text"},"删除",-1)])],8,Xt)])],2)}),128))])):(l(),a("div",Yt,[...t[24]||(t[24]=[e("i",{class:"bi bi-bookmark"},null,-1),e("h5",null,"暂无收藏",-1),e("p",null,"这个收藏夹里还没有任何内容",-1)])]))])])])]),_.value?(l(),a("div",{key:0,class:"modal-overlay",onClick:t[5]||(t[5]=o=>_.value=!1)},[e("div",{class:"modal",onClick:t[4]||(t[4]=G(()=>{},["stop"]))},[e("div",Zt,[t[25]||(t[25]=e("h5",null,"创建新收藏夹",-1)),e("button",{class:"btn-close",onClick:t[1]||(t[1]=o=>_.value=!1)})]),e("div",te,[e("div",ee,[t[26]||(t[26]=e("label",{class:"form-label"},"收藏夹名称",-1)),I(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>k.value=o),type:"text",class:"form-control",placeholder:"输入收藏夹名称...",maxlength:"20"},null,512),[[O,k.value]])])]),e("div",se,[e("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=o=>_.value=!1)}," 取消 "),e("button",{class:"btn btn-primary",onClick:at,disabled:!k.value.trim()}," 创建 ",8,oe)])])])):b("",!0),f.value?(l(),a("div",{key:1,class:"modal-overlay",onClick:t[10]||(t[10]=o=>f.value=!1)},[e("div",{class:"modal",onClick:t[9]||(t[9]=G(()=>{},["stop"]))},[e("div",le,[t[27]||(t[27]=e("h5",null,"编辑备注",-1)),e("button",{class:"btn-close",onClick:t[6]||(t[6]=o=>f.value=!1)})]),e("div",ae,[e("div",ne,[t[28]||(t[28]=e("label",{class:"form-label"},"备注内容",-1)),I(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=o=>h.value=o),class:"form-control",rows:"3",placeholder:"添加备注...",maxlength:"200"},null,512),[[O,h.value]])])]),e("div",ie,[e("button",{class:"btn btn-secondary",onClick:t[8]||(t[8]=o=>f.value=!1)}," 取消 "),e("button",{class:"btn btn-primary",onClick:lt}," 保存 ")])])])):b("",!0)])}}}),_e=vt(re,[["__scopeId","data-v-b5f9d148"]]);export{_e as default};
//# sourceMappingURL=BookmarksView-D8CERW_T.js.map
