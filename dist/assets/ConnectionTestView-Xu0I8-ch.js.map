{"version":3,"file":"ConnectionTestView-Xu0I8-ch.js","sources":["../../src/views/ConnectionTestView.vue"],"sourcesContent":["<template>\r\n  <div class=\"connection-test\">\r\n    <div class=\"container\">\r\n      <h1>🔗 Supabase连接测试</h1>\r\n      \r\n      <div class=\"config-info\">\r\n        <h2>当前配置</h2>\r\n        <div class=\"config-item\">\r\n          <strong>Supabase URL:</strong> \r\n          <span :class=\"{ 'valid': isUrlValid, 'invalid': !isUrlValid }\">\r\n            {{ supabaseUrl || '未配置' }}\r\n          </span>\r\n        </div>\r\n        <div class=\"config-item\">\r\n          <strong>Anon Key:</strong> \r\n          <span :class=\"{ 'valid': isKeyValid, 'invalid': !isKeyValid }\">\r\n            {{ supabaseKey ? '已配置' : '未配置' }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"test-section\">\r\n        <button \r\n          @click=\"testConnection\" \r\n          :disabled=\"testing\"\r\n          class=\"test-btn\"\r\n        >\r\n          {{ testing ? '测试中...' : '测试连接' }}\r\n        </button>\r\n        \r\n        <div v-if=\"testResult\" class=\"result\" :class=\"testResult.success ? 'success' : 'error'\">\r\n          <h3>{{ testResult.success ? '✅ 连接成功' : '❌ 连接失败' }}</h3>\r\n          <p>{{ testResult.message }}</p>\r\n          <div v-if=\"testResult.details\" class=\"details\">\r\n            <pre>{{ testResult.details }}</pre>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"database-status\">\r\n        <h2>数据库表状态</h2>\r\n        <div v-if=\"tableStatus\" class=\"tables\">\r\n          <div \r\n            v-for=\"table in tableStatus\" \r\n            :key=\"table.name\"\r\n            class=\"table-item\"\r\n            :class=\"{ 'accessible': table.accessible, 'inaccessible': !table.accessible }\"\r\n          >\r\n            <span class=\"table-icon\">{{ table.accessible ? '✅' : '❌' }}</span>\r\n            <span class=\"table-name\">{{ table.name }}</span>\r\n            <span class=\"table-status\">{{ table.accessible ? '可访问' : '不可访问' }}</span>\r\n          </div>\r\n        </div>\r\n        <p v-else>点击测试连接查看表状态</p>\r\n      </div>\r\n\r\n      <div class=\"actions\">\r\n        <button @click=\"goToHome\" class=\"action-btn primary\">前往首页</button>\r\n        <button @click=\"openSupabaseDashboard\" class=\"action-btn secondary\">打开Supabase控制台</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { supabase, handleSupabaseError } from '@/services/supabase'\r\n\r\nconst router = useRouter()\r\nconst testing = ref(false)\r\nconst testResult = ref<any>(null)\r\nconst tableStatus = ref<any[]>([])\r\n\r\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL\r\nconst supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY\r\n\r\nconst isUrlValid = computed(() => {\r\n  return supabaseUrl && !supabaseUrl.includes('default.supabase.co')\r\n})\r\n\r\nconst isKeyValid = computed(() => {\r\n  return supabaseKey && !supabaseKey.includes('default')\r\n})\r\n\r\nconst testConnection = async () => {\r\n  testing.value = true\r\n  testResult.value = null\r\n  tableStatus.value = []\r\n\r\n  try {\r\n    console.log('🔗 开始测试Supabase连接...')\r\n    \r\n    // 测试基础连接\r\n    const { data: authData, error: authError } = await supabase.auth.getSession()\r\n    \r\n    if (authError) {\r\n      throw authError\r\n    }\r\n\r\n    // 测试数据库表访问\r\n    const tables = ['profiles', 'posts', 'comments', 'interactions']\r\n    const tableResults = []\r\n\r\n    for (const tableName of tables) {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(tableName)\r\n          .select('count')\r\n          .limit(1)\r\n        \r\n        tableResults.push({\r\n          name: tableName,\r\n          accessible: !error,\r\n          error: error ? error.message : null\r\n        })\r\n      } catch (error) {\r\n        tableResults.push({\r\n          name: tableName,\r\n          accessible: false,\r\n          error: error instanceof Error ? error.message : '未知错误'\r\n        })\r\n      }\r\n    }\r\n\r\n    tableStatus.value = tableResults\r\n\r\n    testResult.value = {\r\n      success: true,\r\n      message: 'Supabase连接成功！所有配置正确。',\r\n      details: `认证状态: ${authData.session ? '已登录' : '未登录'}\\n表访问测试完成`\r\n    }\r\n\r\n    console.log('✅ Supabase连接测试成功')\r\n\r\n  } catch (error) {\r\n    const handledError = handleSupabaseError(error)\r\n    testResult.value = {\r\n      success: false,\r\n      message: handledError.message,\r\n      details: `错误代码: ${handledError.code}\\n建议检查环境变量配置`\r\n    }\r\n    console.error('❌ Supabase连接测试失败:', error)\r\n  } finally {\r\n    testing.value = false\r\n  }\r\n}\r\n\r\nconst goToHome = () => {\r\n  router.push('/')\r\n}\r\n\r\nconst openSupabaseDashboard = () => {\r\n  if (isUrlValid.value) {\r\n    const projectId = supabaseUrl.split('.')[0].replace('https://', '')\r\n    window.open(`https://supabase.com/dashboard/project/${projectId}`, '_blank')\r\n  } else {\r\n    window.open('https://supabase.com/dashboard', '_blank')\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  console.log('🔗 连接测试页面已加载')\r\n  console.log('环境变量检查:')\r\n  console.log('VITE_SUPABASE_URL:', supabaseUrl)\r\n  console.log('VITE_SUPABASE_ANON_KEY:', supabaseKey ? '已配置' : '未配置')\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.connection-test {\r\n  min-height: 100vh;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  padding: 2rem;\r\n}\r\n\r\n.container {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  background: white;\r\n  border-radius: 12px;\r\n  padding: 2rem;\r\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\nh1 {\r\n  text-align: center;\r\n  color: #333;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.config-info {\r\n  background: #f8f9fa;\r\n  padding: 1.5rem;\r\n  border-radius: 8px;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.config-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 0.5rem;\r\n  padding: 0.5rem;\r\n  background: white;\r\n  border-radius: 4px;\r\n}\r\n\r\n.valid {\r\n  color: #10b981;\r\n  font-weight: bold;\r\n}\r\n\r\n.invalid {\r\n  color: #ef4444;\r\n  font-weight: bold;\r\n}\r\n\r\n.test-section {\r\n  text-align: center;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.test-btn {\r\n  background: #3b82f6;\r\n  color: white;\r\n  border: none;\r\n  padding: 0.75rem 2rem;\r\n  border-radius: 6px;\r\n  font-size: 1rem;\r\n  cursor: pointer;\r\n  transition: background 0.3s;\r\n}\r\n\r\n.test-btn:hover:not(:disabled) {\r\n  background: #2563eb;\r\n}\r\n\r\n.test-btn:disabled {\r\n  background: #9ca3af;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.result {\r\n  margin-top: 1rem;\r\n  padding: 1rem;\r\n  border-radius: 6px;\r\n}\r\n\r\n.result.success {\r\n  background: #d1fae5;\r\n  border: 1px solid #10b981;\r\n  color: #065f46;\r\n}\r\n\r\n.result.error {\r\n  background: #fee2e2;\r\n  border: 1px solid #ef4444;\r\n  color: #7f1d1d;\r\n}\r\n\r\n.details {\r\n  margin-top: 0.5rem;\r\n  background: rgba(0, 0, 0, 0.05);\r\n  padding: 0.5rem;\r\n  border-radius: 4px;\r\n  font-family: monospace;\r\n  font-size: 0.875rem;\r\n}\r\n\r\n.database-status {\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.tables {\r\n  display: grid;\r\n  gap: 0.5rem;\r\n}\r\n\r\n.table-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0.75rem;\r\n  border-radius: 6px;\r\n  gap: 1rem;\r\n}\r\n\r\n.table-item.accessible {\r\n  background: #d1fae5;\r\n  border: 1px solid #10b981;\r\n}\r\n\r\n.table-item.inaccessible {\r\n  background: #fee2e2;\r\n  border: 1px solid #ef4444;\r\n}\r\n\r\n.table-icon {\r\n  font-size: 1.2rem;\r\n}\r\n\r\n.table-name {\r\n  font-weight: bold;\r\n  flex: 1;\r\n}\r\n\r\n.actions {\r\n  display: flex;\r\n  gap: 1rem;\r\n  justify-content: center;\r\n}\r\n\r\n.action-btn {\r\n  padding: 0.75rem 1.5rem;\r\n  border: none;\r\n  border-radius: 6px;\r\n  font-size: 1rem;\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.action-btn.primary {\r\n  background: #10b981;\r\n  color: white;\r\n}\r\n\r\n.action-btn.primary:hover {\r\n  background: #059669;\r\n}\r\n\r\n.action-btn.secondary {\r\n  background: #6b7280;\r\n  color: white;\r\n}\r\n\r\n.action-btn.secondary:hover {\r\n  background: #4b5563;\r\n}\r\n</style>"],"names":["router","useRouter","testing","ref","testResult","tableStatus","supabaseUrl","supabaseKey","isUrlValid","computed","isKeyValid","testConnection","authData","authError","supabase","tables","tableResults","tableName","data","error","handledError","handleSupabaseError","goToHome","openSupabaseDashboard","projectId","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_hoisted_3","_hoisted_4","_normalizeClass","_unref","_hoisted_5","_hoisted_6","_hoisted_7","_toDisplayString","_hoisted_8","_hoisted_9","_hoisted_10","_Fragment","_renderList","table","_hoisted_11","_hoisted_12","_hoisted_13"],"mappings":"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"}