import{d as Q,r as V,w as j,c as y,a as i,b as t,e as z,f as N,v as K,t as p,g as b,F as P,h as R,o,_ as G,i as W,j as g,u as U,k as X,l as B,n as T,m as O,p as q,q as tt,s as et}from"./index-02sh5J2l.js";import{useAuthStore as st}from"./auth-DsvB8qh0.js";import{u as J}from"./posts-t7kwi12e.js";import{u as lt}from"./messages-DFVbLfQ6.js";import{P as at}from"./PostCard-Dk0tpnu1.js";import{U as ot}from"./UserAvatar-CYysCMLx.js";import"./bookmarks-DOOoFvsV.js";const nt={class:"modal-header"},it={class:"form-group"},rt={class:"char-count"},ut={class:"form-group"},dt={class:"char-count"},ct={class:"form-group"},vt={key:0,class:"tags-preview"},mt={class:"form-actions"},pt=["disabled"],gt=Q({__name:"CreatePostModal",emits:["close","created"],setup(x,{emit:F}){const L=F,h=J(),r=V({title:"",content:"",tagsInput:"",tags:[]}),l=V(!1);j(()=>r.value.tagsInput,d=>{d.trim()?r.value.tags=d.split(",").map(s=>s.trim()).filter(s=>s.length>0).slice(0,5):r.value.tags=[]});const $=y(()=>r.value.title.trim().length>0&&r.value.content.trim().length>0&&r.value.title.length<=100&&r.value.content.length<=5e3),k=async()=>{var d;if($.value){l.value=!0;try{const s=await h.createPost(r.value.title.trim(),r.value.content.trim(),r.value.tags);s.success?(L("created"),r.value={title:"",content:"",tagsInput:"",tags:[]}):alert(((d=s.error)==null?void 0:d.message)||"发布失败")}catch(s){console.error("发布帖子失败:",s),alert("发布失败，请重试")}finally{l.value=!1}}};return(d,s)=>(o(),i("div",{class:"modal-overlay",onClick:s[6]||(s[6]=m=>d.$emit("close"))},[t("div",{class:"modal-content",onClick:s[5]||(s[5]=z(()=>{},["stop"]))},[t("div",nt,[s[7]||(s[7]=t("h3",null,"发布新帖子",-1)),t("button",{class:"close-btn",onClick:s[0]||(s[0]=m=>d.$emit("close"))},"×")]),t("form",{onSubmit:z(k,["prevent"]),class:"post-form"},[t("div",it,[s[8]||(s[8]=t("label",{for:"title"},"标题",-1)),N(t("input",{id:"title","onUpdate:modelValue":s[1]||(s[1]=m=>r.value.title=m),type:"text",placeholder:"请输入帖子标题",required:"",maxlength:"100"},null,512),[[K,r.value.title]]),t("span",rt,p(r.value.title.length)+"/100",1)]),t("div",ut,[s[9]||(s[9]=t("label",{for:"content"},"内容",-1)),N(t("textarea",{id:"content","onUpdate:modelValue":s[2]||(s[2]=m=>r.value.content=m),placeholder:"请输入帖子内容（支持Markdown语法）",required:"",rows:"8",maxlength:"5000"},null,512),[[K,r.value.content]]),t("span",dt,p(r.value.content.length)+"/5000",1)]),t("div",ct,[s[10]||(s[10]=t("label",{for:"tags"},"标签（可选，用逗号分隔）",-1)),N(t("input",{id:"tags","onUpdate:modelValue":s[3]||(s[3]=m=>r.value.tagsInput=m),type:"text",placeholder:"例如：技术,前端,Vue"},null,512),[[K,r.value.tagsInput]]),r.value.tags.length>0?(o(),i("div",vt,[(o(!0),i(P,null,R(r.value.tags,m=>(o(),i("span",{key:m,class:"tag-preview"},p(m),1))),128))])):b("",!0)]),t("div",mt,[t("button",{type:"button",onClick:s[4]||(s[4]=m=>d.$emit("close")),class:"btn-secondary"}," 取消 "),t("button",{type:"submit",disabled:!$.value||l.value,class:"btn-primary"},p(l.value?"发布中...":"发布"),9,pt)])],32)])]))}}),ft=G(gt,[["__scopeId","data-v-fc518b3f"]]),bt={class:"post-filters"},ht={class:"filters-header"},kt={class:"filters-content"},yt={class:"filter-group"},_t={class:"sort-options"},$t=["onClick"],Ct={class:"filter-group"},wt={class:"time-options"},Pt=["onClick"],xt={class:"filter-group"},Ft={class:"tags-section"},St={key:0,class:"selected-tags"},At=["onClick"],Bt={class:"popular-tags"},Rt={class:"tags-input-group"},Tt=["disabled"],Vt={key:0,class:"tags-list"},It=["onClick"],Mt={class:"tag-count"},Ut={key:0,class:"filter-group"},qt={class:"author-section"},Lt={key:0,class:"selected-author"},zt={key:0,class:"active-filters-summary"},Nt={class:"summary-text"},Kt=Q({__name:"PostFilters",props:{showAuthorFilter:{type:Boolean,default:!1},selectedAuthor:{}},emits:["select-author","filters-changed"],setup(x,{emit:F}){const L=x,h=F,r=J(),{filters:l,getPopularTags:$}=r,k=V(""),d=V([]),s=[{value:"newest",label:"最新发布",icon:"bi bi-clock"},{value:"oldest",label:"最早发布",icon:"bi bi-clock-history"},{value:"most_liked",label:"最多点赞",icon:"bi bi-heart-fill"},{value:"most_commented",label:"最多评论",icon:"bi bi-chat-fill"},{value:"most_viewed",label:"最多浏览",icon:"bi bi-eye-fill"}],m=[{value:"all",label:"全部时间"},{value:"today",label:"今天"},{value:"week",label:"本周"},{value:"month",label:"本月"},{value:"year",label:"今年"}],I=y(()=>l.sortBy!=="newest"||l.timeRange!=="all"||l.tags&&l.tags.length>0||l.authorId),C=y(()=>{let u=0;return l.sortBy!=="newest"&&u++,l.timeRange!=="all"&&u++,l.tags&&l.tags.length>0&&u++,l.authorId&&u++,u}),_=(u,a)=>{r.updateFilters({[u]:a}),h("filters-changed",l)},c=()=>{var a;const u=k.value.trim();if(u&&!((a=l.tags)!=null&&a.includes(u))){const n=l.tags||[];_("tags",[...n,u]),k.value=""}},S=u=>{const a=l.tags||[];_("tags",a.filter(n=>n!==u))},E=u=>{const a=l.tags||[];a.includes(u)?S(u):_("tags",[...a,u])},M=()=>{_("authorId",void 0),h("filters-changed",l)},H=()=>{r.resetFilters(),k.value="",h("filters-changed",l)};return j(()=>L.selectedAuthor,u=>{u?_("authorId",u.id):_("authorId",void 0)}),W(async()=>{const u=await $();u.success&&(d.value=u.data)}),(u,a)=>(o(),i("div",bt,[t("div",ht,[a[3]||(a[3]=t("h5",{class:"filters-title"},"筛选和排序",-1)),I.value?(o(),i("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:H},[...a[2]||(a[2]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1),g(" 重置 ",-1)])])):b("",!0)]),t("div",kt,[t("div",yt,[a[4]||(a[4]=t("label",{class:"filter-label"},"排序方式:",-1)),t("div",_t,[(o(),i(P,null,R(s,n=>t("button",{key:n.value,class:T(["sort-btn",{active:U(l).sortBy===n.value}]),onClick:A=>_("sortBy",n.value)},[t("i",{class:T(n.icon)},null,2),g(" "+p(n.label),1)],10,$t)),64))])]),t("div",Ct,[a[5]||(a[5]=t("label",{class:"filter-label"},"时间范围:",-1)),t("div",wt,[(o(),i(P,null,R(m,n=>t("button",{key:n.value,class:T(["time-btn",{active:U(l).timeRange===n.value}]),onClick:A=>_("timeRange",n.value)},p(n.label),11,Pt)),64))])]),t("div",xt,[a[7]||(a[7]=t("label",{class:"filter-label"},"标签筛选:",-1)),t("div",Ft,[U(l).tags&&U(l).tags.length>0?(o(),i("div",St,[(o(!0),i(P,null,R(U(l).tags,n=>(o(),i("span",{key:n,class:"selected-tag"},[g(" #"+p(n)+" ",1),t("button",{class:"remove-tag",onClick:A=>S(n)},[...a[6]||(a[6]=[t("i",{class:"bi bi-x"},null,-1)])],8,At)]))),128))])):b("",!0),t("div",Bt,[t("div",Rt,[N(t("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>k.value=n),type:"text",class:"form-control tag-input",placeholder:"输入标签名称...",onKeyup:X(c,["enter"])},null,544),[[K,k.value]]),t("button",{class:"btn btn-primary",onClick:c,disabled:!k.value.trim()}," 添加 ",8,Tt)]),d.value.length>0?(o(),i("div",Vt,[(o(!0),i(P,null,R(d.value,n=>{var A;return o(),i("span",{key:n.tag,class:T(["popular-tag",{selected:(A=U(l).tags)==null?void 0:A.includes(n.tag)}]),onClick:D=>E(n.tag)},[g(" #"+p(n.tag)+" ",1),t("span",Mt,"("+p(n.count)+")",1)],10,It)}),128))])):b("",!0)])])]),x.showAuthorFilter?(o(),i("div",Ut,[a[10]||(a[10]=t("label",{class:"filter-label"},"作者筛选:",-1)),t("div",qt,[x.selectedAuthor?(o(),i("div",Lt,[B(ot,{user:x.selectedAuthor,size:"sm"},null,8,["user"]),t("span",null,p(x.selectedAuthor.username),1),t("button",{class:"remove-author",onClick:M},[...a[8]||(a[8]=[t("i",{class:"bi bi-x"},null,-1)])])])):(o(),i("button",{key:1,class:"btn btn-outline-primary",onClick:a[1]||(a[1]=n=>u.$emit("select-author"))},[...a[9]||(a[9]=[t("i",{class:"bi bi-person-plus"},null,-1),g(" 选择作者 ",-1)])]))])])):b("",!0)]),I.value?(o(),i("div",zt,[t("span",Nt," 当前有 "+p(C.value)+" 个筛选条件 ",1)])):b("",!0)]))}}),Dt=G(Kt,[["__scopeId","data-v-b2a045d0"]]),Et={class:"home"},Ht={class:"header"},Ot={class:"container"},Qt={class:"nav"},jt={key:0,class:"unread-indicator"},Gt={class:"main"},Jt={class:"container"},Wt={class:"quick-search"},Xt={class:"search-input-group"},Yt={class:"post-list"},Zt={class:"post-list-header"},te={key:0,class:"post-count"},ee={class:"header-actions"},se={key:0,class:"loading"},le={key:1,class:"empty"},ae={key:2,class:"pagination-nav"},oe={class:"pagination"},ne=["onClick"],ie=Q({__name:"HomeView",setup(x){const F=et(),L=st(),h=J(),r=lt(),l=V(!1),$=V(!1),k=V(""),d=y(()=>L.isAuthenticated),s=y(()=>h.posts),m=y(()=>r.unreadCount),I=y(()=>h.totalPosts),C=y(()=>h.currentPage),_=y(()=>h.pageSize),c=y(()=>h.filters),S=y(()=>Math.ceil(I.value/_.value)),E=y(()=>{const f=[],e=Math.max(1,C.value-2),w=Math.min(S.value,C.value+2);for(let v=e;v<=w;v++)f.push(v);return f});W(async()=>{await M(),d.value&&await r.fetchUnreadCount()}),j(c,async()=>{await M(1)},{deep:!0});const M=async(f=1)=>{$.value=!0;try{await h.fetchPosts(f,_.value)}catch(e){console.error("加载帖子失败:",e)}finally{$.value=!1}},H=async f=>{if(!d.value){F.push("/login");return}await h.toggleLike(f)},u=f=>{F.push(`/post/${f}`)},a=()=>{l.value=!1,M()},n=()=>{k.value.trim()&&F.push({path:"/search",query:{q:k.value.trim()}})},A=f=>{},D=async f=>{f<1||f>S.value||await M(f)},Y=()=>c.value.sortBy==="most_liked"?"热门帖子":c.value.sortBy==="most_commented"?"热议帖子":c.value.sortBy==="most_viewed"?"热门浏览":c.value.sortBy==="oldest"?"早期帖子":c.value.timeRange==="today"?"今日帖子":c.value.timeRange==="week"?"本周帖子":c.value.timeRange==="month"?"本月帖子":c.value.timeRange==="year"?"今年帖子":c.value.tags&&c.value.tags.length>0?"标签筛选":"最新帖子",Z=()=>c.value.tags&&c.value.tags.length>0?"没有找到包含这些标签的帖子":c.value.timeRange!=="all"?"该时间范围内暂无帖子":c.value.authorId?"该用户暂无发布的帖子":"快来发布第一个帖子吧！";return(f,e)=>{const w=tt("RouterLink");return o(),i("div",Et,[t("header",Ht,[t("div",Ot,[e[12]||(e[12]=t("h1",{class:"logo"},"连接者论坛",-1)),t("nav",Qt,[B(w,{to:"/",class:"nav-link"},{default:q(()=>[...e[6]||(e[6]=[g("首页",-1)])]),_:1}),B(w,{to:"/search",class:"nav-link"},{default:q(()=>[...e[7]||(e[7]=[t("i",{class:"bi bi-search"},null,-1),g(" 搜索 ",-1)])]),_:1}),d.value?(o(),i(P,{key:1},[B(w,{to:"/profile",class:"nav-link"},{default:q(()=>[...e[9]||(e[9]=[g("个人中心",-1)])]),_:1}),B(w,{to:"/bookmarks",class:"nav-link"},{default:q(()=>[...e[10]||(e[10]=[t("i",{class:"bi bi-bookmark"},null,-1),g(" 收藏 ",-1)])]),_:1}),B(w,{to:"/messages",class:"nav-link"},{default:q(()=>[e[11]||(e[11]=g(" 消息中心 ",-1)),m.value>0?(o(),i("span",jt,p(m.value),1)):b("",!0)]),_:1})],64)):(o(),O(w,{key:0,to:"/login",class:"nav-link"},{default:q(()=>[...e[8]||(e[8]=[g("登录",-1)])]),_:1}))])])]),t("main",Gt,[t("div",Jt,[t("div",Wt,[t("div",Xt,[N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=v=>k.value=v),type:"text",class:"form-control search-input",placeholder:"快速搜索帖子、用户或评论...",onKeyup:X(n,["enter"])},null,544),[[K,k.value]]),t("button",{class:"btn btn-primary search-btn",onClick:n},[...e[13]||(e[13]=[t("i",{class:"bi bi-search"},null,-1)])])])]),B(Dt,{onFiltersChanged:A,class:"post-filters-section"}),t("div",Yt,[t("div",Zt,[t("h2",null,[g(p(Y())+" ",1),I.value>0?(o(),i("span",te,"("+p(I.value)+")",1)):b("",!0)]),t("div",ee,[d.value?(o(),i("button",{key:0,onClick:e[1]||(e[1]=v=>l.value=!0),class:"btn-primary"},[...e[14]||(e[14]=[t("i",{class:"bi bi-plus-circle"},null,-1),g(" 发布帖子 ",-1)])])):b("",!0)])]),(o(!0),i(P,null,R(s.value,v=>(o(),O(at,{key:v.id,post:v,onLike:H,onComment:u},null,8,["post"]))),128)),$.value?(o(),i("div",se,[...e[15]||(e[15]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"加载中...")],-1),t("p",null,"加载中...",-1)])])):b("",!0),!$.value&&s.value.length===0?(o(),i("div",le,[e[16]||(e[16]=t("i",{class:"bi bi-inbox"},null,-1)),e[17]||(e[17]=t("h5",null,"暂无帖子",-1)),t("p",null,p(Z()),1),d.value?(o(),i("button",{key:0,onClick:e[2]||(e[2]=v=>l.value=!0),class:"btn-primary"}," 发布第一个帖子 ")):b("",!0)])):b("",!0),S.value>1?(o(),i("nav",ae,[t("ul",oe,[t("li",{class:T(["page-item",{disabled:C.value===1}])},[t("a",{class:"page-link",href:"#",onClick:e[3]||(e[3]=z(v=>D(C.value-1),["prevent"]))},[...e[18]||(e[18]=[t("i",{class:"bi bi-chevron-left"},null,-1),g(" 上一页 ",-1)])])],2),(o(!0),i(P,null,R(E.value,v=>(o(),i("li",{key:v,class:T(["page-item",{active:v===C.value}])},[t("a",{class:"page-link",href:"#",onClick:z(re=>D(v),["prevent"])},p(v),9,ne)],2))),128)),t("li",{class:T(["page-item",{disabled:C.value===S.value}])},[t("a",{class:"page-link",href:"#",onClick:e[4]||(e[4]=z(v=>D(C.value+1),["prevent"]))},[...e[19]||(e[19]=[g(" 下一页 ",-1),t("i",{class:"bi bi-chevron-right"},null,-1)])])],2)])])):b("",!0)])])]),l.value?(o(),O(ft,{key:0,onClose:e[5]||(e[5]=v=>l.value=!1),onCreated:a})):b("",!0)])}}}),fe=G(ie,[["__scopeId","data-v-afe1d2be"]]);export{fe as default};
//# sourceMappingURL=HomeView-C-OxfNJB.js.map
