import{d as x,r as k,w as A,c as P,a as r,b as e,e as V,f as b,v as $,t as g,g as v,F as S,h as I,o as a,_ as L,i as F,j as h,k as R,l as C,m as U,u as q,n as w}from"./index-CtP2hjPR.js";import{useAuthStore as D}from"./auth-1hv12URH.js";import{u as M}from"./posts-BCS3gLhB.js";import{P as H}from"./PostCard-CowoRDAD.js";const T={class:"modal-header"},j={class:"form-group"},E={class:"char-count"},z={class:"form-group"},G={class:"char-count"},J={class:"form-group"},K={key:0,class:"tags-preview"},O={class:"form-actions"},Q=["disabled"],W=x({__name:"CreatePostModal",emits:["close","created"],setup(B,{emit:c}){const y=c,d=M(),s=k({title:"",content:"",tagsInput:"",tags:[]}),i=k(!1);A(()=>s.value.tagsInput,n=>{n.trim()?s.value.tags=n.split(",").map(t=>t.trim()).filter(t=>t.length>0).slice(0,5):s.value.tags=[]});const u=P(()=>s.value.title.trim().length>0&&s.value.content.trim().length>0&&s.value.title.length<=100&&s.value.content.length<=5e3),m=async()=>{var n;if(u.value){i.value=!0;try{const t=await d.createPost(s.value.title.trim(),s.value.content.trim(),s.value.tags);t.success?(y("created"),s.value={title:"",content:"",tagsInput:"",tags:[]}):alert(((n=t.error)==null?void 0:n.message)||"发布失败")}catch(t){console.error("发布帖子失败:",t),alert("发布失败，请重试")}finally{i.value=!1}}};return(n,t)=>(a(),r("div",{class:"modal-overlay",onClick:t[6]||(t[6]=l=>n.$emit("close"))},[e("div",{class:"modal-content",onClick:t[5]||(t[5]=V(()=>{},["stop"]))},[e("div",T,[t[7]||(t[7]=e("h3",null,"发布新帖子",-1)),e("button",{class:"close-btn",onClick:t[0]||(t[0]=l=>n.$emit("close"))},"×")]),e("form",{onSubmit:V(m,["prevent"]),class:"post-form"},[e("div",j,[t[8]||(t[8]=e("label",{for:"title"},"标题",-1)),b(e("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.title=l),type:"text",placeholder:"请输入帖子标题",required:"",maxlength:"100"},null,512),[[$,s.value.title]]),e("span",E,g(s.value.title.length)+"/100",1)]),e("div",z,[t[9]||(t[9]=e("label",{for:"content"},"内容",-1)),b(e("textarea",{id:"content","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.content=l),placeholder:"请输入帖子内容（支持Markdown语法）",required:"",rows:"8",maxlength:"5000"},null,512),[[$,s.value.content]]),e("span",G,g(s.value.content.length)+"/5000",1)]),e("div",J,[t[10]||(t[10]=e("label",{for:"tags"},"标签（可选，用逗号分隔）",-1)),b(e("input",{id:"tags","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.tagsInput=l),type:"text",placeholder:"例如：技术,前端,Vue"},null,512),[[$,s.value.tagsInput]]),s.value.tags.length>0?(a(),r("div",K,[(a(!0),r(S,null,I(s.value.tags,l=>(a(),r("span",{key:l,class:"tag-preview"},g(l),1))),128))])):v("",!0)]),e("div",O,[e("button",{type:"button",onClick:t[4]||(t[4]=l=>n.$emit("close")),class:"btn-secondary"}," 取消 "),e("button",{type:"submit",disabled:!u.value||i.value,class:"btn-primary"},g(i.value?"发布中...":"发布"),9,Q)])],32)])]))}}),X=L(W,[["__scopeId","data-v-fc518b3f"]]),Y={class:"home"},Z={class:"header"},tt={class:"container"},et={class:"nav"},st={class:"main"},ot={class:"container"},lt={class:"post-list"},at={class:"post-list-header"},nt={key:0,class:"loading"},it={key:1,class:"empty"},rt=x({__name:"HomeView",setup(B){const c=q(),y=D(),d=M(),s=k(!1),i=k(!1),u=P(()=>y.isAuthenticated),m=P(()=>d.posts);F(async()=>{await n()});const n=async()=>{i.value=!0;try{await d.fetchPosts()}finally{i.value=!1}},t=async p=>{if(!u.value){c.push("/login");return}await d.toggleLike(p)},l=p=>{c.push(`/post/${p}`)},N=()=>{s.value=!1,n()};return(p,o)=>{const _=U("RouterLink");return a(),r("div",Y,[e("header",Z,[e("div",tt,[o[5]||(o[5]=e("h1",{class:"logo"},"连接者论坛",-1)),e("nav",et,[R(_,{to:"/",class:"nav-link"},{default:C(()=>[...o[2]||(o[2]=[w("首页",-1)])]),_:1}),u.value?(a(),h(_,{key:1,to:"/profile",class:"nav-link"},{default:C(()=>[...o[4]||(o[4]=[w("个人中心",-1)])]),_:1})):(a(),h(_,{key:0,to:"/login",class:"nav-link"},{default:C(()=>[...o[3]||(o[3]=[w("登录",-1)])]),_:1}))])])]),e("main",st,[e("div",ot,[e("div",lt,[e("div",at,[o[6]||(o[6]=e("h2",null,"最新帖子",-1)),u.value?(a(),r("button",{key:0,onClick:o[0]||(o[0]=f=>s.value=!0),class:"btn-primary"}," 发布帖子 ")):v("",!0)]),(a(!0),r(S,null,I(m.value,f=>(a(),h(H,{key:f.id,post:f,onLike:t,onComment:l},null,8,["post"]))),128)),i.value?(a(),r("div",nt,"加载中...")):v("",!0),!i.value&&m.value.length===0?(a(),r("div",it," 暂无帖子，快来发布第一个帖子吧！ ")):v("",!0)])])]),s.value?(a(),h(X,{key:0,onClose:o[1]||(o[1]=f=>s.value=!1),onCreated:N})):v("",!0)])}}}),mt=L(rt,[["__scopeId","data-v-d1e777c0"]]);export{mt as default};
//# sourceMappingURL=HomeView-C96zmu4T.js.map
