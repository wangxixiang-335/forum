import{useAuthStore as b}from"./auth-1hv12URH.js";import{u as w}from"./posts-BCS3gLhB.js";import{d as $,c as _,a as i,o as l,p as r,b as s,n as m,t as a,g as c,k as x,l as y,m as L,F as P,h as S,_ as D}from"./index-CtP2hjPR.js";const N={class:"post-header"},T={class:"user-info"},V=["src","alt"],B={class:"user-details"},M={class:"level-badge"},z={class:"post-time"},A={class:"post-actions"},E={key:0,class:"pinned-indicator"},F={class:"post-content"},R={class:"post-title"},I={class:"post-excerpt"},j={key:0,class:"post-tags"},q={class:"post-footer"},G={class:"interaction-stats"},H={class:"view-count"},J=$({__name:"PostCard",props:{post:{}},emits:["like","comment"],setup(t){const d=t,p=b(),f=w(),v=_(()=>{var e;return((e=p.user)==null?void 0:e.id)===d.post.user_id}),h=async()=>{if(!confirm("确定要删除这个帖子吗？此操作不可恢复。"))return;const e=await f.deletePost(d.post.id);e.success?console.log("帖子删除成功"):(console.error("删除帖子失败:",e.error),alert("删除失败: "+e.error))},g=e=>e>=10?"level-10-plus":e>=7?"level-7-9":e>=4?"level-4-6":"level-1-3",k=e=>{const o=new Date(e),n=new Date().getTime()-o.getTime();return n<6e4?"刚刚":n<36e5?`${Math.floor(n/6e4)}分钟前`:n<864e5?`${Math.floor(n/36e5)}小时前`:n<6048e5?`${Math.floor(n/864e5)}天前`:o.toLocaleDateString("zh-CN")},C=e=>{const o=e.replace(/[#*_~`]/g,"").replace(/\n/g," ");return o.length>100?o.substring(0,100)+"...":o};return(e,o)=>{const u=L("RouterLink");return l(),i("article",{class:r(["post-card",{"post-pinned":t.post.is_pinned}])},[s("div",N,[s("div",T,[s("img",{src:t.post.profiles.avatar_url||"/default-avatar.png",alt:t.post.profiles.username,class:"avatar"},null,8,V),s("div",B,[s("span",{class:r(["username",g(t.post.profiles.level)])},[m(a(t.post.profiles.username)+" ",1),s("span",M,"Lv."+a(t.post.profiles.level),1)],2),s("span",z,a(k(t.post.created_at)),1)])]),s("div",A,[t.post.is_pinned?(l(),i("div",E,[...o[2]||(o[2]=[s("span",null,"📌 置顶",-1)])])):c("",!0),v.value?(l(),i("button",{key:1,class:"delete-btn",onClick:h,title:"删除帖子"}," 🗑️ ")):c("",!0)])]),s("div",F,[s("h3",R,[x(u,{to:`/post/${t.post.id}`,class:"title-link"},{default:y(()=>[m(a(t.post.title),1)]),_:1},8,["to"])]),s("p",I,a(C(t.post.content)),1),t.post.tags&&t.post.tags.length>0?(l(),i("div",j,[(l(!0),i(P,null,S(t.post.tags.slice(0,3),n=>(l(),i("span",{key:n,class:"tag"}," #"+a(n),1))),128))])):c("",!0)]),s("div",q,[s("div",G,[s("button",{class:r(["interaction-btn",{active:t.post.user_has_liked}]),onClick:o[0]||(o[0]=n=>e.$emit("like",t.post.id))}," 👍 "+a(t.post.like_count),3),s("button",{class:"interaction-btn",onClick:o[1]||(o[1]=n=>e.$emit("comment",t.post.id))}," 💬 "+a(t.post.comment_count),1),s("span",H,"👁️ "+a(t.post.view_count),1)])])],2)}}}),U=D(J,[["__scopeId","data-v-c5065c7b"]]);export{U as P};
//# sourceMappingURL=PostCard-CowoRDAD.js.map
