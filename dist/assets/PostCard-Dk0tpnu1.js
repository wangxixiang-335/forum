import{useAuthStore as H}from"./auth-DsvB8qh0.js";import{u as G}from"./posts-t7kwi12e.js";import{u as q}from"./bookmarks-DOOoFvsV.js";import{U as z}from"./UserAvatar-CYysCMLx.js";import{d as P,r as b,a as u,o as a,b as e,e as x,l as D,j as $,t as r,f as B,v as I,_ as U,c as T,i as E,g,H as J,F as R,h as j,w as K,n as C,m as L,p as O,q as Q}from"./index-02sh5J2l.js";import{u as W}from"./messages-DFVbLfQ6.js";const X={class:"modal-header"},Y={class:"modal-title"},Z={class:"modal-body"},_={class:"mb-3"},ee={class:"form-text"},se={class:"modal-footer"},te=["disabled"],oe={key:0},le={key:1},ne=P({__name:"SendMessageModal",props:{recipient:{}},emits:["close","sent"],setup(o,{emit:k}){const y=o,w=k,f=W(),{sendMessage:h}=f,v=b(""),d=b(!1),c=async()=>{if(v.value.trim()){d.value=!0;try{const i=await h(y.recipient.id,v.value.trim());i.success?(v.value="",w("sent"),w("close")):alert("å‘é€å¤±è´¥ï¼š"+(i.error||"æœªçŸ¥é”™è¯¯"))}catch(i){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",i),alert("å‘é€å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{d.value=!1}}};return(i,l)=>(a(),u("div",{class:"message-modal-overlay",onClick:l[4]||(l[4]=p=>i.$emit("close"))},[e("div",{class:"message-modal",onClick:l[3]||(l[3]=x(()=>{},["stop"]))},[e("div",X,[e("h5",Y,[D(z,{user:o.recipient,size:"sm"},null,8,["user"]),$(" å‘é€ç§ä¿¡ç»™ "+r(o.recipient.username),1)]),e("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=p=>i.$emit("close"))})]),e("div",Z,[e("form",{onSubmit:x(c,["prevent"])},[e("div",_,[l[5]||(l[5]=e("label",{for:"message-content",class:"form-label"},"æ¶ˆæ¯å†…å®¹",-1)),B(e("textarea",{id:"message-content","onUpdate:modelValue":l[1]||(l[1]=p=>v.value=p),class:"form-control",rows:"4",placeholder:"è¾“å…¥ä½ æƒ³è¯´çš„è¯...",maxlength:"1000",required:""},null,512),[[I,v.value]]),e("div",ee,r(v.value.length)+"/1000 å­—ç¬¦ ",1)]),l[8]||(l[8]=e("div",{class:"message-tips"},[e("h6",null,"æ¸©é¦¨æç¤ºï¼š"),e("ul",null,[e("li",null,"è¯·å‹å–„äº¤æµï¼Œå°Šé‡ä»–äºº"),e("li",null,"ç¦æ­¢å‘é€åžƒåœ¾ä¿¡æ¯æˆ–ä¸å½“å†…å®¹"),e("li",null,"æ¶ˆæ¯å‘é€åŽæ— æ³•æ’¤å›ž")])],-1)),e("div",se,[e("button",{type:"button",class:"btn btn-secondary",onClick:l[2]||(l[2]=p=>i.$emit("close"))}," å–æ¶ˆ "),e("button",{type:"submit",class:"btn btn-primary",disabled:!v.value.trim()||d.value},[d.value?(a(),u("span",oe,[...l[6]||(l[6]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),$(" å‘é€ä¸­... ",-1)])])):(a(),u("span",le,[...l[7]||(l[7]=[e("i",{class:"bi bi-send me-2"},null,-1),$(" å‘é€æ¶ˆæ¯ ",-1)])]))],8,te)])],32)])])]))}}),ae=U(ne,[["__scopeId","data-v-f1e529ae"]]),ie={class:"modal-header"},re={class:"modal-body"},ue={class:"mb-3"},de={class:"folder-input-group"},ce=["value"],me={key:0,class:"mb-3"},ve={class:"form-text"},pe={class:"mb-3"},be={class:"form-text"},ke={class:"post-preview"},fe={class:"preview-content"},ge={class:"modal-footer"},$e=["disabled"],ye={key:0},we={key:1},he=P({__name:"BookmarkModal",props:{post:{}},emits:["close","bookmarked"],setup(o,{emit:k}){const y=o,w=k,f=q(),{addBookmark:h,fetchFolders:v,createFolder:d}=f,c=b(""),i=b(""),l=b(""),p=b(!1),M=b([]),S=T(()=>c.value==="__new__"?i.value.trim()!=="":c.value!==""),V=(n,s)=>n.length<=s?n:n.substring(0,s)+"...",F=async()=>{if(S.value){p.value=!0;try{let n=c.value;if(c.value==="__new__"){n=i.value.trim(),console.log("åˆ›å»ºæ–°æ”¶è—å¤¹:",n);const t=await d(n);if(!t.success){console.error("åˆ›å»ºæ”¶è—å¤¹å¤±è´¥:",t.error),alert("åˆ›å»ºæ”¶è—å¤¹å¤±è´¥ï¼š"+(t.error||"æœªçŸ¥é”™è¯¯"));return}console.log("åˆ›å»ºæ”¶è—å¤¹æˆåŠŸ")}console.log("å¼€å§‹æ”¶è—ï¼Œæ–‡ä»¶å¤¹:",n,"å¸–å­ID:",y.post.id);const s=await h("post",y.post.id,n,l.value.trim());console.log("æ”¶è—ç»“æžœ:",s),s.success?(w("bookmarked"),w("close")):(console.error("æ”¶è—å¤±è´¥:",s.error),alert("æ”¶è—å¤±è´¥ï¼š"+(s.error||"æœªçŸ¥é”™è¯¯")))}catch(n){console.error("æ”¶è—å¼‚å¸¸:",n),alert("æ”¶è—å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{p.value=!1}}},N=async()=>{try{await v(),M.value=f.folders}catch(n){console.error("åŠ è½½æ”¶è—å¤¹å¤±è´¥:",n)}};return E(()=>{N()}),(n,s)=>(a(),u("div",{class:"bookmark-modal-overlay",onClick:s[6]||(s[6]=t=>n.$emit("close"))},[e("div",{class:"bookmark-modal",onClick:s[5]||(s[5]=x(()=>{},["stop"]))},[e("div",ie,[s[7]||(s[7]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-bookmark-star"}),$(" æ”¶è—å¸–å­ ")],-1)),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=t=>n.$emit("close"))})]),e("div",re,[e("form",{onSubmit:x(F,["prevent"])},[e("div",ue,[s[10]||(s[10]=e("label",{for:"folder-name",class:"form-label"},"æ”¶è—å¤¹",-1)),e("div",de,[B(e("select",{id:"folder-name","onUpdate:modelValue":s[1]||(s[1]=t=>c.value=t),class:"form-select",required:""},[s[8]||(s[8]=e("option",{value:""},"é€‰æ‹©æ”¶è—å¤¹...",-1)),(a(!0),u(R,null,j(M.value,t=>(a(),u("option",{key:t,value:t},r(t),9,ce))),128)),s[9]||(s[9]=e("option",{value:"__new__"},"+ åˆ›å»ºæ–°æ”¶è—å¤¹",-1))],512),[[J,c.value]])])]),c.value==="__new__"?(a(),u("div",me,[s[11]||(s[11]=e("label",{for:"new-folder-name",class:"form-label"},"æ–°æ”¶è—å¤¹åç§°",-1)),B(e("input",{id:"new-folder-name","onUpdate:modelValue":s[2]||(s[2]=t=>i.value=t),type:"text",class:"form-control",placeholder:"è¾“å…¥æ”¶è—å¤¹åç§°...",maxlength:"20",required:""},null,512),[[I,i.value]]),e("div",ve,r(i.value.length)+"/20 å­—ç¬¦ ",1)])):g("",!0),e("div",pe,[s[12]||(s[12]=e("label",{for:"bookmark-note",class:"form-label"},"å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰",-1)),B(e("textarea",{id:"bookmark-note","onUpdate:modelValue":s[3]||(s[3]=t=>l.value=t),class:"form-control",rows:"3",placeholder:"æ·»åŠ å¤‡æ³¨...",maxlength:"200"},null,512),[[I,l.value]]),e("div",be,r(l.value.length)+"/200 å­—ç¬¦ ",1)]),e("div",ke,[s[13]||(s[13]=e("h6",null,"å¸–å­é¢„è§ˆ",-1)),e("div",fe,[e("h6",null,r(o.post.title),1),e("p",null,r(V(o.post.content,100)),1)])]),e("div",ge,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[4]||(s[4]=t=>n.$emit("close"))}," å–æ¶ˆ "),e("button",{type:"submit",class:"btn btn-primary",disabled:!S.value||p.value},[p.value?(a(),u("span",ye,[...s[14]||(s[14]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),$(" æ”¶è—ä¸­... ",-1)])])):(a(),u("span",we,[...s[15]||(s[15]=[e("i",{class:"bi bi-bookmark-plus me-2"},null,-1),$(" ç¡®è®¤æ”¶è— ",-1)])]))],8,$e)])],32)])])]))}}),Ce=U(he,[["__scopeId","data-v-3f37483c"]]),Me={class:"post-header"},Se={class:"user-info"},Be={class:"user-details"},xe={class:"level-badge"},Ve={class:"post-time"},Fe={class:"post-actions"},Ne={key:0,class:"pinned-indicator"},De={class:"action-buttons"},Ie={class:"post-content"},Te={class:"post-title"},Pe={class:"post-excerpt"},Ue={key:0,class:"post-tags"},Ae={class:"post-footer"},Le={class:"interaction-stats"},qe={class:"view-count"},ze=P({__name:"PostCard",props:{post:{}},emits:["like","comment"],setup(o){const k=o,y=H(),w=G(),f=q(),h=b(!1),v=b(!1),d=b(!1),c=T(()=>y.isAuthenticated),i=T(()=>{var s;return((s=y.user)==null?void 0:s.id)===k.post.user_id});E(async()=>{c.value&&(d.value=await f.checkIsBookmarked("post",k.post.id))}),K(c,async s=>{s?d.value=await f.checkIsBookmarked("post",k.post.id):d.value=!1});const l=()=>{h.value=!0},p=()=>{console.log("ç§ä¿¡å‘é€æˆåŠŸ")},M=()=>{v.value=!0},S=async()=>{d.value=await f.checkIsBookmarked("post",k.post.id),console.log("å¸–å­æ”¶è—æˆåŠŸï¼ŒçŠ¶æ€å·²æ›´æ–°")},V=async()=>{if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¸–å­å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"))return;const s=await w.deletePost(k.post.id);s.success?console.log("å¸–å­åˆ é™¤æˆåŠŸ"):(console.error("åˆ é™¤å¸–å­å¤±è´¥:",s.error),alert("åˆ é™¤å¤±è´¥: "+s.error))},F=s=>s>=10?"level-10-plus":s>=7?"level-7-9":s>=4?"level-4-6":"level-1-3",N=s=>{const t=new Date(s),m=new Date().getTime()-t.getTime();return m<6e4?"åˆšåˆš":m<36e5?`${Math.floor(m/6e4)}åˆ†é’Ÿå‰`:m<864e5?`${Math.floor(m/36e5)}å°æ—¶å‰`:m<6048e5?`${Math.floor(m/864e5)}å¤©å‰`:t.toLocaleDateString("zh-CN")},n=s=>{const t=s.replace(/[#*_~`]/g,"").replace(/\n/g," ");return t.length>100?t.substring(0,100)+"...":t};return(s,t)=>{const A=Q("RouterLink");return a(),u("article",{class:C(["post-card",{"post-pinned":o.post.is_pinned}])},[e("div",Me,[e("div",Se,[D(z,{username:o.post.profiles.username,"avatar-id":o.post.profiles.avatar_url,size:"40px"},null,8,["username","avatar-id"]),e("div",Be,[e("span",{class:C(["username",F(o.post.profiles.level)])},[$(r(o.post.profiles.username)+" ",1),e("span",xe,"Lv."+r(o.post.profiles.level),1)],2),e("span",Ve,r(N(o.post.created_at)),1)])]),e("div",Fe,[o.post.is_pinned?(a(),u("div",Ne,[...t[4]||(t[4]=[e("span",null,"ðŸ“Œ ç½®é¡¶",-1)])])):g("",!0),e("div",De,[c.value&&!i.value?(a(),u("button",{key:0,class:"action-btn message-btn",onClick:l,title:"å‘é€ç§ä¿¡"},[...t[5]||(t[5]=[e("i",{class:"bi bi-envelope"},null,-1),e("span",null,"ç§ä¿¡",-1)])])):g("",!0),c.value?(a(),u("button",{key:1,class:C(["action-btn bookmark-btn",{active:d.value}]),onClick:M,title:"æ”¶è—å¸–å­"},[e("i",{class:C(["bi",d.value?"bi-bookmark-fill":"bi-bookmark"])},null,2),e("span",null,r(d.value?"å·²æ”¶è—":"æ”¶è—"),1)],2)):g("",!0),i.value?(a(),u("button",{key:2,class:"action-btn delete-btn",onClick:V,title:"åˆ é™¤å¸–å­"},[...t[6]||(t[6]=[e("i",{class:"bi bi-trash"},null,-1),e("span",null,"åˆ é™¤",-1)])])):g("",!0)])])]),e("div",Ie,[e("h3",Te,[D(A,{to:`/post/${o.post.id}`,class:"title-link"},{default:O(()=>[$(r(o.post.title),1)]),_:1},8,["to"])]),e("p",Pe,r(n(o.post.content)),1),o.post.tags&&o.post.tags.length>0?(a(),u("div",Ue,[(a(!0),u(R,null,j(o.post.tags.slice(0,3),m=>(a(),u("span",{key:m,class:"tag"}," #"+r(m),1))),128))])):g("",!0)]),e("div",Ae,[e("div",Le,[e("button",{class:C(["interaction-btn",{active:o.post.user_has_liked}]),onClick:t[0]||(t[0]=m=>s.$emit("like",o.post.id))},[e("i",{class:C(["bi",o.post.user_has_liked?"bi-heart-fill":"bi-heart"])},null,2),e("span",null,"ç‚¹èµž "+r(o.post.like_count),1)],2),e("button",{class:"interaction-btn",onClick:t[1]||(t[1]=m=>s.$emit("comment",o.post.id))},[t[7]||(t[7]=e("i",{class:"bi bi-chat"},null,-1)),e("span",null,"è¯„è®º "+r(o.post.comment_count),1)]),e("span",qe,[t[8]||(t[8]=e("i",{class:"bi bi-eye"},null,-1)),e("span",null,"æµè§ˆ "+r(o.post.view_count),1)])])]),h.value?(a(),L(ae,{key:0,recipient:{id:o.post.user_id,username:o.post.profiles.username,avatar_url:o.post.profiles.avatar_url,level:o.post.profiles.level},onClose:t[2]||(t[2]=m=>h.value=!1),onSent:p},null,8,["recipient"])):g("",!0),v.value?(a(),L(Ce,{key:1,post:{id:o.post.id,title:o.post.title,content:o.post.content},onClose:t[3]||(t[3]=m=>v.value=!1),onBookmarked:S},null,8,["post"])):g("",!0)],2)}}}),Ke=U(ze,[["__scopeId","data-v-39ce9635"]]);export{Ke as P};
//# sourceMappingURL=PostCard-Dk0tpnu1.js.map
