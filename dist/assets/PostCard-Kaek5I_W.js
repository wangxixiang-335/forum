import{useAuthStore as j}from"./auth-hIVPxf3j.js";import{u as K}from"./posts-CXiqjE5Q.js";import{u as q}from"./bookmarks-QnlEBPDt.js";import{U as z}from"./UserAvatar-xuan3Pxw.js";import{d as P,r as b,c as i,h as n,a as e,e as V,k as I,f as g,t as d,j as x,v as T,_ as U,i as L,l as E,b as f,K as G,F as R,g as _,w as H,n as B,p as A,q as J,s as O}from"./index-DvT1nwGZ.js";import{u as Q}from"./messages-C7dDKSwE.js";const W={class:"modal-header"},X={class:"modal-title"},Y={class:"modal-body"},Z={class:"mb-3"},ee={class:"form-text"},se={class:"modal-footer"},te=["disabled"],oe={key:0},le={key:1},ne=P({__name:"SendMessageModal",props:{recipient:{}},emits:["close","sent"],setup(t,{emit:k}){const w=t,h=k,$=Q(),{sendMessage:M}=$,v=b(""),u=b(!1),c=async()=>{if(v.value.trim()){u.value=!0;try{const r=await M(w.recipient.id,v.value.trim());r.success?(v.value="",h("sent"),h("close")):alert("å‘é€å¤±è´¥ï¼š"+(r.error||"æœªçŸ¥é”™è¯¯"))}catch(r){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",r),alert("å‘é€å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{u.value=!1}}};return(r,l)=>(n(),i("div",{class:"message-modal-overlay",onClick:l[4]||(l[4]=p=>r.$emit("close"))},[e("div",{class:"message-modal",onClick:l[3]||(l[3]=V(()=>{},["stop"]))},[e("div",W,[e("h5",X,[I(z,{user:t.recipient,size:"sm"},null,8,["user"]),g(" å‘é€ç§ä¿¡ç»™ "+d(t.recipient.username),1)]),e("button",{type:"button",class:"btn-close",onClick:l[0]||(l[0]=p=>r.$emit("close"))})]),e("div",Y,[e("form",{onSubmit:V(c,["prevent"])},[e("div",Z,[l[5]||(l[5]=e("label",{for:"message-content",class:"form-label"},"æ¶ˆæ¯å†…å®¹",-1)),x(e("textarea",{id:"message-content","onUpdate:modelValue":l[1]||(l[1]=p=>v.value=p),class:"form-control",rows:"4",placeholder:"è¾“å…¥ä½ æƒ³è¯´çš„è¯...",maxlength:"1000",required:""},null,512),[[T,v.value]]),e("div",ee,d(v.value.length)+"/1000 å­—ç¬¦ ",1)]),l[8]||(l[8]=e("div",{class:"message-tips"},[e("h6",null,"æ¸©é¦¨æç¤ºï¼š"),e("ul",null,[e("li",null,"è¯·å‹å–„äº¤æµï¼Œå°Šé‡ä»–äºº"),e("li",null,"ç¦æ­¢å‘é€åžƒåœ¾ä¿¡æ¯æˆ–ä¸å½“å†…å®¹"),e("li",null,"æ¶ˆæ¯å‘é€åŽæ— æ³•æ’¤å›ž")])],-1)),e("div",se,[e("button",{type:"button",class:"btn btn-secondary",onClick:l[2]||(l[2]=p=>r.$emit("close"))}," å–æ¶ˆ "),e("button",{type:"submit",class:"btn btn-primary",disabled:!v.value.trim()||u.value},[u.value?(n(),i("span",oe,[...l[6]||(l[6]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),g(" å‘é€ä¸­... ",-1)])])):(n(),i("span",le,[...l[7]||(l[7]=[e("i",{class:"bi bi-send me-2"},null,-1),g(" å‘é€æ¶ˆæ¯ ",-1)])]))],8,te)])],32)])])]))}}),ae=U(ne,[["__scopeId","data-v-f1e529ae"]]),ie={class:"modal-header"},re={class:"modal-body"},de={class:"mb-3"},ue={class:"folder-input-group"},ce=["disabled"],me=["value"],ve={key:0,class:"loading-folders"},pe={key:0,class:"mb-3"},be={class:"form-text"},ke={class:"mb-3"},fe={class:"form-text"},ge={class:"post-preview"},$e={class:"preview-content"},ye={class:"modal-footer"},we=["disabled"],he={key:0},Me={key:1},Ce=P({__name:"BookmarkModal",props:{post:{}},emits:["close","bookmarked"],setup(t,{emit:k}){const w=t,h=k,$=q(),{addBookmark:M,fetchFolders:v,createFolder:u}=$,c=b(""),r=b(""),l=b(""),p=b(!1),C=b(!1),y=b(["é»˜è®¤æ”¶è—å¤¹"]),S=L(()=>c.value==="__new__"?r.value.trim()!=="":c.value!==""),F=(o,s)=>o.length<=s?o:o.substring(0,s)+"...",N=async()=>{if(S.value){p.value=!0;try{let o=c.value;if(c.value==="__new__"){o=r.value.trim(),console.log("åˆ›å»ºæ–°æ”¶è—å¤¹:",o);const a=await u(o);if(!a.success){console.error("åˆ›å»ºæ”¶è—å¤¹å¤±è´¥:",a.error),alert("åˆ›å»ºæ”¶è—å¤¹å¤±è´¥ï¼š"+(a.error||"æœªçŸ¥é”™è¯¯"));return}console.log("åˆ›å»ºæ”¶è—å¤¹æˆåŠŸ")}console.log("å¼€å§‹æ”¶è—ï¼Œæ–‡ä»¶å¤¹:",o,"å¸–å­ID:",w.post.id);const s=await M("post",w.post.id,o,l.value.trim());console.log("æ”¶è—ç»“æžœ:",s),s.success?(h("bookmarked"),h("close")):(console.error("æ”¶è—å¤±è´¥:",s.error),alert("æ”¶è—å¤±è´¥ï¼š"+(s.error||"æœªçŸ¥é”™è¯¯")))}catch(o){console.error("æ”¶è—å¼‚å¸¸:",o),alert("æ”¶è—å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{p.value=!1}}},D=async()=>{C.value=!0;try{console.log("BookmarkModal: å¼€å§‹åŠ è½½æ”¶è—å¤¹..."),await v(),y.value=$.folders,console.log("BookmarkModal: æ”¶è—å¤¹åŠ è½½å®Œæˆ:",y.value),y.value.length===0&&(console.log("BookmarkModal: æ²¡æœ‰æ‰¾åˆ°æ”¶è—å¤¹ï¼Œä½¿ç”¨é»˜è®¤æ”¶è—å¤¹"),y.value=["é»˜è®¤æ”¶è—å¤¹"])}catch(o){console.error("BookmarkModal: åŠ è½½æ”¶è—å¤¹å¤±è´¥:",o),y.value=["é»˜è®¤æ”¶è—å¤¹"]}finally{C.value=!1}};return E(()=>{D()}),(o,s)=>(n(),i("div",{class:"bookmark-modal-overlay",onClick:s[6]||(s[6]=a=>o.$emit("close"))},[e("div",{class:"bookmark-modal",onClick:s[5]||(s[5]=V(()=>{},["stop"]))},[e("div",ie,[s[7]||(s[7]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-bookmark-star"}),g(" æ”¶è—å¸–å­ ")],-1)),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=a=>o.$emit("close"))})]),e("div",re,[e("form",{onSubmit:V(N,["prevent"])},[e("div",de,[s[11]||(s[11]=e("label",{for:"folder-name",class:"form-label"},"æ”¶è—å¤¹",-1)),e("div",ue,[x(e("select",{id:"folder-name","onUpdate:modelValue":s[1]||(s[1]=a=>c.value=a),class:"form-select",required:"",disabled:C.value},[s[8]||(s[8]=e("option",{value:""},"é€‰æ‹©æ”¶è—å¤¹...",-1)),(n(!0),i(R,null,_(y.value,a=>(n(),i("option",{key:a,value:a},d(a),9,me))),128)),s[9]||(s[9]=e("option",{value:"__new__"},"+ åˆ›å»ºæ–°æ”¶è—å¤¹",-1))],8,ce),[[G,c.value]]),C.value?(n(),i("div",ve,[...s[10]||(s[10]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),g(" åŠ è½½æ”¶è—å¤¹... ",-1)])])):f("",!0)])]),c.value==="__new__"?(n(),i("div",pe,[s[12]||(s[12]=e("label",{for:"new-folder-name",class:"form-label"},"æ–°æ”¶è—å¤¹åç§°",-1)),x(e("input",{id:"new-folder-name","onUpdate:modelValue":s[2]||(s[2]=a=>r.value=a),type:"text",class:"form-control",placeholder:"è¾“å…¥æ”¶è—å¤¹åç§°...",maxlength:"20",required:""},null,512),[[T,r.value]]),e("div",be,d(r.value.length)+"/20 å­—ç¬¦ ",1)])):f("",!0),e("div",ke,[s[13]||(s[13]=e("label",{for:"bookmark-note",class:"form-label"},"å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰",-1)),x(e("textarea",{id:"bookmark-note","onUpdate:modelValue":s[3]||(s[3]=a=>l.value=a),class:"form-control",rows:"3",placeholder:"æ·»åŠ å¤‡æ³¨...",maxlength:"200"},null,512),[[T,l.value]]),e("div",fe,d(l.value.length)+"/200 å­—ç¬¦ ",1)]),e("div",ge,[s[14]||(s[14]=e("h6",null,"å¸–å­é¢„è§ˆ",-1)),e("div",$e,[e("h6",null,d(t.post.title),1),e("p",null,d(F(t.post.content,100)),1)])]),e("div",ye,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[4]||(s[4]=a=>o.$emit("close"))}," å–æ¶ˆ "),e("button",{type:"submit",class:"btn btn-primary",disabled:!S.value||p.value},[p.value?(n(),i("span",he,[...s[15]||(s[15]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),g(" æ”¶è—ä¸­... ",-1)])])):(n(),i("span",Me,[...s[16]||(s[16]=[e("i",{class:"bi bi-bookmark-plus me-2"},null,-1),g(" ç¡®è®¤æ”¶è— ",-1)])]))],8,we)])],32)])])]))}}),Be=U(Ce,[["__scopeId","data-v-6e397ee4"]]),Se={class:"post-header"},xe={class:"user-info"},Ve={class:"user-details"},Fe={class:"level-badge"},Ne={class:"post-time"},De={class:"post-actions"},Ie={key:0,class:"pinned-indicator"},Te={class:"action-buttons"},Le={class:"post-content"},Pe={class:"post-title"},Ue={class:"post-excerpt"},Ae={key:0,class:"post-tags"},qe={class:"post-footer"},ze={class:"interaction-stats"},Ee={class:"view-count"},Re=P({__name:"PostCard",props:{post:{}},emits:["like","comment"],setup(t){const k=t,w=j(),h=K(),$=q(),M=b(!1),v=b(!1),u=b(!1),c=L(()=>w.isAuthenticated),r=L(()=>{var o;return((o=w.user)==null?void 0:o.id)===k.post.user_id});E(async()=>{c.value&&(u.value=await $.checkIsBookmarked("post",k.post.id))}),H(c,async o=>{o?u.value=await $.checkIsBookmarked("post",k.post.id):u.value=!1});const l=()=>{M.value=!0},p=()=>{console.log("ç§ä¿¡å‘é€æˆåŠŸ")},C=()=>{v.value=!0},y=async()=>{u.value=await $.checkIsBookmarked("post",k.post.id),console.log("å¸–å­æ”¶è—æˆåŠŸï¼ŒçŠ¶æ€å·²æ›´æ–°")},S=async()=>{if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¸–å­å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"))return;const o=await h.deletePost(k.post.id);o.success?console.log("å¸–å­åˆ é™¤æˆåŠŸ"):(console.error("åˆ é™¤å¸–å­å¤±è´¥:",o.error),alert("åˆ é™¤å¤±è´¥: "+o.error))},F=o=>o>=10?"level-10-plus":o>=7?"level-7-9":o>=4?"level-4-6":"level-1-3",N=o=>{const s=new Date(o),m=new Date().getTime()-s.getTime();return m<6e4?"åˆšåˆš":m<36e5?`${Math.floor(m/6e4)}åˆ†é’Ÿå‰`:m<864e5?`${Math.floor(m/36e5)}å°æ—¶å‰`:m<6048e5?`${Math.floor(m/864e5)}å¤©å‰`:s.toLocaleDateString("zh-CN")},D=o=>{const s=o.replace(/[#*_~`]/g,"").replace(/\n/g," ");return s.length>100?s.substring(0,100)+"...":s};return(o,s)=>{const a=O("RouterLink");return n(),i("article",{class:B(["post-card",{"post-pinned":t.post.is_pinned}])},[e("div",Se,[e("div",xe,[I(z,{username:t.post.profiles.username,"avatar-id":t.post.profiles.avatar_url,size:"40px"},null,8,["username","avatar-id"]),e("div",Ve,[e("span",{class:B(["username",F(t.post.profiles.level)])},[g(d(t.post.profiles.username)+" ",1),e("span",Fe,"Lv."+d(t.post.profiles.level),1)],2),e("span",Ne,d(N(t.post.created_at)),1)])]),e("div",De,[t.post.is_pinned?(n(),i("div",Ie,[...s[4]||(s[4]=[e("span",null,"ðŸ“Œ ç½®é¡¶",-1)])])):f("",!0),e("div",Te,[c.value&&!r.value?(n(),i("button",{key:0,class:"action-btn message-btn",onClick:l,title:"å‘é€ç§ä¿¡"},[...s[5]||(s[5]=[e("i",{class:"bi bi-envelope"},null,-1),e("span",null,"ç§ä¿¡",-1)])])):f("",!0),c.value?(n(),i("button",{key:1,class:B(["action-btn bookmark-btn",{active:u.value}]),onClick:C,title:"æ”¶è—å¸–å­"},[e("i",{class:B(["bi",u.value?"bi-bookmark-fill":"bi-bookmark"])},null,2),e("span",null,d(u.value?"å·²æ”¶è—":"æ”¶è—"),1)],2)):f("",!0),r.value?(n(),i("button",{key:2,class:"action-btn delete-btn",onClick:S,title:"åˆ é™¤å¸–å­"},[...s[6]||(s[6]=[e("i",{class:"bi bi-trash"},null,-1),e("span",null,"åˆ é™¤",-1)])])):f("",!0)])])]),e("div",Le,[e("h3",Pe,[I(a,{to:`/post/${t.post.id}`,class:"title-link"},{default:J(()=>[g(d(t.post.title),1)]),_:1},8,["to"])]),e("p",Ue,d(D(t.post.content)),1),t.post.tags&&t.post.tags.length>0?(n(),i("div",Ae,[(n(!0),i(R,null,_(t.post.tags.slice(0,3),m=>(n(),i("span",{key:m,class:"tag"}," #"+d(m),1))),128))])):f("",!0)]),e("div",qe,[e("div",ze,[e("button",{class:B(["interaction-btn",{active:t.post.user_has_liked}]),onClick:s[0]||(s[0]=m=>o.$emit("like",t.post.id))},[e("i",{class:B(["bi",t.post.user_has_liked?"bi-heart-fill":"bi-heart"])},null,2),e("span",null,"ç‚¹èµž "+d(t.post.like_count),1)],2),e("button",{class:"interaction-btn",onClick:s[1]||(s[1]=m=>o.$emit("comment",t.post.id))},[s[7]||(s[7]=e("i",{class:"bi bi-chat"},null,-1)),e("span",null,"è¯„è®º "+d(t.post.comment_count),1)]),e("span",Ee,[s[8]||(s[8]=e("i",{class:"bi bi-eye"},null,-1)),e("span",null,"æµè§ˆ "+d(t.post.view_count),1)])])]),M.value?(n(),A(ae,{key:0,recipient:{id:t.post.user_id,username:t.post.profiles.username,avatar_url:t.post.profiles.avatar_url,level:t.post.profiles.level},onClose:s[2]||(s[2]=m=>M.value=!1),onSent:p},null,8,["recipient"])):f("",!0),v.value?(n(),A(Be,{key:1,post:{id:t.post.id,title:t.post.title,content:t.post.content},onClose:s[3]||(s[3]=m=>v.value=!1),onBookmarked:y},null,8,["post"])):f("",!0)],2)}}}),Oe=U(Re,[["__scopeId","data-v-ebd7fb4e"]]);export{Oe as P};
//# sourceMappingURL=PostCard-Kaek5I_W.js.map
