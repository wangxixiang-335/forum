import{d as P,c as I,a as r,o as a,b as t,l as w,n as $,j as v,t as l,g as S,_ as A,C as j,r as C,i as E,x as G,p as D,q as J,F as V,h as N,f as K,v as O,s as Q,m as W}from"./index-02sh5J2l.js";import{useAuthStore as B}from"./auth-DsvB8qh0.js";import{u as z}from"./posts-t7kwi12e.js";import{U as X}from"./UserAvatar-CYysCMLx.js";const Y={class:"comment-item"},Z={class:"comment-header"},tt={class:"comment-author"},et={class:"author-info"},st={class:"level-badge"},ot={class:"comment-time"},nt={class:"comment-actions"},at={key:0,class:"pinned-badge"},lt={class:"comment-content"},ct={class:"comment-actions"},rt=P({__name:"CommentItem",props:{comment:{}},emits:["like"],setup(i){const p=i,g=B(),L=z(),_=I(()=>{var n;return((n=g.user)==null?void 0:n.id)===p.comment.user_id}),h=async()=>{if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"))return;const n=await L.deleteComment(p.comment.id);n.success?(console.log("è¯„è®ºåˆ é™¤æˆåŠŸ"),location.reload()):(console.error("åˆ é™¤è¯„è®ºå¤±è´¥:",n.error),alert("åˆ é™¤å¤±è´¥: "+n.error))},k=n=>n>=10?"level-10-plus":n>=7?"level-7-9":n>=4?"level-4-6":"level-1-3",u=n=>{const s=new Date(n),c=new Date().getTime()-s.getTime();return c<6e4?"åˆšåˆš":c<36e5?`${Math.floor(c/6e4)}åˆ†é’Ÿå‰`:c<864e5?`${Math.floor(c/36e5)}å°æ—¶å‰`:c<6048e5?`${Math.floor(c/864e5)}å¤©å‰`:s.toLocaleDateString("zh-CN")};return(n,s)=>{var m,c,b,f,y;return a(),r("div",Y,[t("div",Z,[t("div",tt,[w(X,{username:((m=i.comment.profiles)==null?void 0:m.username)||"åŒ¿åç”¨æˆ·","avatar-id":(c=i.comment.profiles)==null?void 0:c.avatar_url,size:"32px"},null,8,["username","avatar-id"]),t("div",et,[t("span",{class:$(["username",k(((b=i.comment.profiles)==null?void 0:b.level)||1)])},[v(l(((f=i.comment.profiles)==null?void 0:f.username)||"åŒ¿åç”¨æˆ·")+" ",1),t("span",st,"Lv."+l(((y=i.comment.profiles)==null?void 0:y.level)||1),1)],2),t("span",ot,l(u(i.comment.created_at)),1)])]),t("div",nt,[i.comment.is_pinned?(a(),r("div",at," ðŸ“Œ ç½®é¡¶ ")):S("",!0),_.value?(a(),r("button",{key:1,class:"delete-btn",onClick:h,title:"åˆ é™¤è¯„è®º"}," ðŸ—‘ï¸ ")):S("",!0)])]),t("div",lt,[t("p",null,l(i.comment.content),1)]),t("div",ct,[t("button",{class:$(["action-btn",{active:i.comment.user_has_liked}]),onClick:s[0]||(s[0]=T=>n.$emit("like",i.comment.id))}," ðŸ‘ "+l(i.comment.like_count),3),s[1]||(s[1]=t("button",{class:"action-btn"}," ðŸ’¬ å›žå¤ ",-1))])])}}}),it=A(rt,[["__scopeId","data-v-aae051a5"]]),ut={class:"post-detail"},mt={class:"header"},dt={class:"container"},vt={class:"title"},_t={class:"main"},ht={class:"container"},ft={key:0,class:"loading"},pt={key:1,class:"post-content"},gt={class:"post-article"},kt={class:"post-header"},bt={class:"author-info"},yt=["src","alt"],Ct={class:"author-details"},wt={class:"level-badge"},$t={class:"post-time"},Lt={class:"post-stats"},xt={class:"stat"},Dt={class:"stat"},It={class:"stat"},St={class:"post-body"},Tt=["innerHTML"],Mt={key:0,class:"post-tags"},Vt={class:"post-actions"},Nt={class:"comments-section"},Pt={key:0,class:"comment-input"},At={class:"comment-actions"},Bt={class:"char-count"},zt=["disabled"],Rt={key:1,class:"comment-login-prompt"},Ut={key:2,class:"comments-list"},qt={key:3,class:"no-comments"},Ft={key:2,class:"error"},Ht=P({__name:"PostDetailView",setup(i){const p=j(),g=Q(),L=B(),_=z(),h=p.params.id,k=C(!0),u=C(""),n=C(),s=I(()=>_.currentPost),m=I(()=>L.isAuthenticated),c=C([]);E(async()=>{await b(),await f()});const b=async()=>{try{await _.fetchPostById(h)}catch(o){console.error("åŠ è½½å¸–å­å¤±è´¥:",o)}finally{k.value=!1}},f=async()=>{try{const{data:o,error:e}=await G.from("comments").select(`
        *,
        profiles:user_id (username, avatar_url, level)
      `).eq("post_id",h).order("created_at",{ascending:!0});if(e)throw e;c.value=o||[]}catch(o){console.error("åŠ è½½è¯„è®ºå¤±è´¥:",o),c.value=[]}},y=async()=>{if(!m.value){g.push("/login");return}try{await _.toggleLike(h)}catch(o){console.error("ç‚¹èµžå¤±è´¥:",o)}},T=()=>{var o;if(!m.value){g.push("/login");return}(o=n.value)==null||o.focus()},R=async()=>{var o;if(u.value.trim())try{const e=await _.createComment(h,u.value.trim());e.success?(u.value="",await f()):alert(((o=e.error)==null?void 0:o.message)||"è¯„è®ºå‘å¸ƒå¤±è´¥")}catch(e){console.error("æäº¤è¯„è®ºå¤±è´¥:",e),alert("è¯„è®ºå‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•")}},U=o=>{console.log("ç‚¹èµžè¯„è®º:",o)},q=o=>o>=10?"level-10-plus":o>=7?"level-7-9":o>=4?"level-4-6":"level-1-3",F=o=>new Date(o).toLocaleString("zh-CN"),H=o=>o.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>");return(o,e)=>{var M;const x=J("RouterLink");return a(),r("div",ut,[t("header",mt,[t("div",dt,[w(x,{to:"/",class:"back-link"},{default:D(()=>[...e[1]||(e[1]=[v("â† è¿”å›žé¦–é¡µ",-1)])]),_:1}),t("h1",vt,l((M=s.value)==null?void 0:M.title),1)])]),t("main",_t,[t("div",ht,[k.value?(a(),r("div",ft,"åŠ è½½ä¸­...")):s.value?(a(),r("div",pt,[t("article",gt,[t("div",kt,[t("div",bt,[t("img",{src:s.value.profiles.avatar_url||"/default-avatar.png",alt:s.value.profiles.username,class:"avatar"},null,8,yt),t("div",Ct,[t("span",{class:$(["username",q(s.value.profiles.level)])},[v(l(s.value.profiles.username)+" ",1),t("span",wt,"Lv."+l(s.value.profiles.level),1)],2),t("span",$t,l(F(s.value.created_at)),1)])]),t("div",Lt,[t("span",xt,"ðŸ‘ï¸ "+l(s.value.view_count)+" æµè§ˆ",1),t("span",Dt,"ðŸ‘ "+l(s.value.like_count)+" ç‚¹èµž",1),t("span",It,"ðŸ’¬ "+l(s.value.comment_count)+" è¯„è®º",1)])]),t("div",St,[t("div",{class:"content",innerHTML:H(s.value.content)},null,8,Tt),s.value.tags&&s.value.tags.length>0?(a(),r("div",Mt,[(a(!0),r(V,null,N(s.value.tags,d=>(a(),r("span",{key:d,class:"tag"}," #"+l(d),1))),128))])):S("",!0)]),t("div",Vt,[t("button",{class:$(["action-btn",{active:s.value.user_has_liked}]),onClick:y}," ðŸ‘ "+l(s.value.like_count),3),t("button",{class:"action-btn",onClick:T}," ðŸ’¬ è¯„è®º "),e[2]||(e[2]=t("button",{class:"action-btn"}," ðŸ“Œ æ”¶è— ",-1))])]),t("section",Nt,[t("h3",null,"è¯„è®º ("+l(s.value.comment_count)+")",1),m.value?(a(),r("div",Pt,[K(t("textarea",{ref_key:"commentInput",ref:n,"onUpdate:modelValue":e[0]||(e[0]=d=>u.value=d),placeholder:"å†™ä¸‹ä½ çš„è¯„è®º...",rows:"3",maxlength:"1000"},null,512),[[O,u.value]]),t("div",At,[t("span",Bt,l(u.value.length)+"/1000",1),t("button",{onClick:R,disabled:!u.value.trim(),class:"submit-btn"}," å‘å¸ƒè¯„è®º ",8,zt)])])):(a(),r("div",Rt,[t("p",null,[e[4]||(e[4]=v("è¯· ",-1)),w(x,{to:"/login"},{default:D(()=>[...e[3]||(e[3]=[v("ç™»å½•",-1)])]),_:1}),e[5]||(e[5]=v(" åŽå‘è¡¨è¯„è®º",-1))])])),c.value.length>0?(a(),r("div",Ut,[(a(!0),r(V,null,N(c.value,d=>(a(),W(it,{key:d.id,comment:d,onLike:U},null,8,["comment"]))),128))])):(a(),r("div",qt,[...e[6]||(e[6]=[t("p",null,"æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼",-1)])]))])])):(a(),r("div",Ft,[e[8]||(e[8]=t("p",null,"å¸–å­ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤",-1)),w(x,{to:"/",class:"back-link"},{default:D(()=>[...e[7]||(e[7]=[v("è¿”å›žé¦–é¡µ",-1)])]),_:1})]))])])])}}}),Kt=A(Ht,[["__scopeId","data-v-1f981749"]]);export{Kt as default};
//# sourceMappingURL=PostDetailView-B2E0jiVW.js.map
