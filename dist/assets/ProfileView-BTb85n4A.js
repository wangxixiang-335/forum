import{useAuthStore as V}from"./auth-1hv12URH.js";import{u as B}from"./posts-BCS3gLhB.js";import{P as R}from"./PostCard-CowoRDAD.js";import{d as z,r as m,c as d,i as F,a as l,b as e,k as x,l as g,m as U,p as q,n as p,t as i,C as I,F as y,h as k,o as n,j,_ as A}from"./index-CtP2hjPR.js";const T={class:"profile"},X={class:"header"},G={class:"container"},H={class:"main"},J={class:"container"},K={key:0,class:"loading"},O={key:1,class:"profile-content"},Q={class:"profile-card"},W={class:"profile-header"},Y=["src","alt"],Z={class:"profile-info"},$={class:"level-badge"},ee={class:"member-since"},se={class:"experience-section"},te={class:"exp-info"},oe={class:"exp-progress"},ne={class:"exp-text"},le={class:"privileges-section"},ae={class:"privileges-list"},re={class:"privilege-icon"},ie={class:"privilege-name"},ce={class:"user-posts"},ue={key:0,class:"posts-list"},de={key:1,class:"no-posts"},ve={key:2,class:"error"},pe=z({__name:"ProfileView",setup(_e){const c=V(),L=B(),_=m(!0),u=m([]),o=d(()=>c.profile),v=d(()=>o.value?Math.floor(100*Math.pow(o.value.level+1,1.5)):0),P=d(()=>o.value?Math.floor(100*Math.pow(o.value.level,1.5)):0),f=d(()=>{if(!o.value)return 0;const s=o.value.experience_points,t=P.value,a=v.value;if(s>=a)return 100;const r=s-t,h=a-t;if(h<=0)return 0;const E=Math.floor(r/h*100);return Math.max(0,Math.min(100,E))}),w=d(()=>{var a;const s=((a=o.value)==null?void 0:a.level)||1,t=[];return t.push({id:"basic",name:"发帖、评论、点赞",icon:"📝"}),s>=4&&t.push({id:"style",name:"特殊徽章显示",icon:"🎖️"}),s>=7&&t.push({id:"color",name:"个性化色彩",icon:"🎨"}),s>=10&&t.push({id:"mod",name:"评论置顶权限",icon:"⭐"}),t});F(async()=>{await C()});const C=async()=>{try{c.profile||await c.fetchProfile(),await b()}catch(s){console.error("加载用户数据失败:",s)}finally{_.value=!1}},b=async()=>{if(c.user)try{const s=await L.fetchUserPosts(c.user.id);s.success?u.value=s.data||[]:(console.error("加载用户帖子失败:",s.error),u.value=[])}catch(s){console.error("加载用户帖子失败:",s),u.value=[]}},M=s=>{console.log("点赞帖子:",s)},S=s=>{console.log("评论帖子:",s)},N=s=>s>=10?"level-10-plus":s>=7?"level-7-9":s>=4?"level-4-6":"level-1-3",D=s=>new Date(s).toLocaleDateString("zh-CN");return(s,t)=>{const a=U("RouterLink");return n(),l("div",T,[e("header",X,[e("div",G,[x(a,{to:"/",class:"back-link"},{default:g(()=>[...t[0]||(t[0]=[p("← 返回首页",-1)])]),_:1}),t[1]||(t[1]=e("h1",null,"个人中心",-1))])]),e("main",H,[e("div",J,[_.value?(n(),l("div",K,"加载中...")):o.value?(n(),l("div",O,[e("div",Q,[e("div",W,[e("img",{src:o.value.avatar_url||"/default-avatar.png",alt:o.value.username,class:"avatar"},null,8,Y),e("div",Z,[e("h2",{class:q(["username",N(o.value.level)])},[p(i(o.value.username)+" ",1),e("span",$,"Lv."+i(o.value.level),1)],2),e("p",ee," 注册时间："+i(D(o.value.created_at)),1)])]),e("div",se,[e("div",te,[e("span",null,"经验值："+i(o.value.experience_points),1),e("span",null,"下一等级："+i(v.value-o.value.experience_points>0?v.value-o.value.experience_points+" EXP":"已满"),1)]),e("div",oe,[e("div",{class:"exp-bar",style:I({width:f.value+"%"})},null,4),e("span",ne,i(f.value)+"%",1)])]),e("div",le,[t[2]||(t[2]=e("h3",null,"当前特权",-1)),e("div",ae,[(n(!0),l(y,null,k(w.value,r=>(n(),l("div",{key:r.id,class:"privilege-item"},[e("span",re,i(r.icon),1),e("span",ie,i(r.name),1)]))),128))])])]),e("div",ce,[t[5]||(t[5]=e("h3",null,"我的帖子",-1)),u.value.length>0?(n(),l("div",ue,[(n(!0),l(y,null,k(u.value,r=>(n(),j(R,{key:r.id,post:r,onLike:M,onComment:S},null,8,["post"]))),128))])):(n(),l("div",de,[t[4]||(t[4]=e("p",null,"还没有发布过帖子",-1)),x(a,{to:"/",class:"btn-primary"},{default:g(()=>[...t[3]||(t[3]=[p("去发布第一个帖子",-1)])]),_:1})]))])])):(n(),l("div",ve,[...t[6]||(t[6]=[e("p",null,"用户信息加载失败",-1)])]))])])])}}}),ge=A(pe,[["__scopeId","data-v-f93bdf86"]]);export{ge as default};
//# sourceMappingURL=ProfileView-BTb85n4A.js.map
