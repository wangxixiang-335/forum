const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-02sh5J2l.js","assets/index-DZoKQPTh.css"])))=>i.map(i=>d[i]);
import{d as M,r as y,i as z,a as i,b as s,F,h as P,D as ee,o as r,n as U,E as V,t as u,_ as J,c as g,C as oe,G as B,g as L,l as b,p as E,q as se,j as x,e as te,m as ae}from"./index-02sh5J2l.js";import{useAuthStore as le}from"./auth-DsvB8qh0.js";import{u as ne}from"./posts-t7kwi12e.js";import{P as re}from"./PostCard-Dk0tpnu1.js";import{U as ie}from"./UserAvatar-CYysCMLx.js";import"./bookmarks-DOOoFvsV.js";import"./messages-DFVbLfQ6.js";const ce={class:"avatar-selector"},ue={class:"selector-header"},de={class:"avatar-grid"},ve=["onClick"],pe={class:"avatar-icon"},fe={class:"avatar-name"},me={class:"avatar-actions"},_e=["disabled"],ge=M({__name:"AvatarSelector",emits:["close","select"],setup(q,{emit:w}){const c=w,f=y(""),v=y(""),k=[{id:"cat",name:"çŒ«å’ª",icon:"ğŸ±",color:"#FF6B6B"},{id:"dog",name:"å°ç‹—",icon:"ğŸ¶",color:"#4ECDC4"},{id:"bear",name:"å°ç†Š",icon:"ğŸ»",color:"#45B7D1"},{id:"rabbit",name:"å…”å­",icon:"ğŸ°",color:"#96CEB4"},{id:"panda",name:"ç†ŠçŒ«",icon:"ğŸ¼",color:"#FFEAA7"},{id:"fox",name:"ç‹ç‹¸",icon:"ğŸ¦Š",color:"#DDA0DD"},{id:"lion",name:"ç‹®å­",icon:"ğŸ¦",color:"#FFA07A"},{id:"monkey",name:"çŒ´å­",icon:"ğŸµ",color:"#98D8C8"},{id:"pig",name:"å°çŒª",icon:"ğŸ·",color:"#FFB6C1"},{id:"cow",name:"å¥¶ç‰›",icon:"ğŸ®",color:"#87CEEB"},{id:"tiger",name:"è€è™",icon:"ğŸ¯",color:"#FFD700"},{id:"elephant",name:"å¤§è±¡",icon:"ğŸ˜",color:"#F0E68C"},{id:"giraffe",name:"é•¿é¢ˆé¹¿",icon:"ğŸ¦’",color:"#FFA500"},{id:"penguin",name:"ä¼é¹…",icon:"ğŸ§",color:"#B0E0E6"},{id:"owl",name:"çŒ«å¤´é¹°",icon:"ğŸ¦‰",color:"#D8BFD8"},{id:"turtle",name:"ä¹Œé¾Ÿ",icon:"ğŸ¢",color:"#90EE90"}];z(()=>{const n=localStorage.getItem("userAvatar");n&&(f.value=n,v.value=n)});const m=n=>{f.value=n.id},p=()=>{if(!f.value)return;const n=k.find(t=>t.id===f.value);n&&(c("select",n),ee(()=>{c("close")}))};return(n,t)=>(r(),i("div",ce,[s("div",ue,[t[2]||(t[2]=s("h3",null,"é€‰æ‹©å¤´åƒ",-1)),s("button",{onClick:t[0]||(t[0]=d=>n.$emit("close")),class:"close-btn",title:"å…³é—­"}," âœ• ")]),s("div",de,[(r(),i(F,null,P(k,d=>s("div",{key:d.id,class:U(["avatar-option",{active:f.value===d.id}]),onClick:I=>m(d)},[s("div",{class:"avatar-preview",style:V({backgroundColor:d.color})},[s("span",pe,u(d.icon),1)],4),s("span",fe,u(d.name),1)],10,ve)),64))]),s("div",me,[s("button",{onClick:p,class:"btn-primary",disabled:!f.value}," ä¿å­˜å¤´åƒ ",8,_e),s("button",{onClick:t[1]||(t[1]=d=>n.$emit("close")),class:"btn-secondary"}," å–æ¶ˆ ")])]))}}),he=J(ge,[["__scopeId","data-v-d2a5bd20"]]),be={class:"profile"},ke={class:"header"},xe={class:"container"},ye={class:"header-nav"},Ce={key:0,class:"nav"},Ee={class:"main"},we={class:"container"},De={key:0,class:"loading"},Ie={key:1,class:"profile-content"},Ae={class:"profile-card"},Le={class:"profile-header"},Fe={key:0,class:"avatar-edit-hint"},Pe={key:1,class:"avatar-locked"},Se={class:"profile-info"},$e={class:"level-badge"},Ne={class:"member-since"},Be={class:"experience-section"},Me={class:"exp-info"},ze={class:"exp-progress"},Ue={class:"exp-text"},Ve={class:"privileges-section"},Je={class:"privileges-list"},qe={class:"privilege-icon"},Oe={class:"privilege-name"},Re={class:"user-posts"},je={key:0,class:"posts-list"},Xe={key:1,class:"no-posts"},Te={key:2,class:"error"},Ze={class:"modal-content"},Ge=M({__name:"ProfileView",setup(q){const w=oe(),c=le(),f=ne(),v=g(()=>!!w.params.id),k=g(()=>w.params.id),m=y(!0),p=y([]),n=y(!1),t=g(()=>v.value?d.value:c.profile),d=y(null),I=e=>{const o=[0,50,150,300,500,800,1200,1800,2500,3500,5e3,7e3,1e4];if(e<=1)return 0;if(e>=o.length){const a=o[o.length-1],l=e-o.length+1;return a+l*2e3}return o[e-1]},D=g(()=>{if(!t.value)return 50;const e=t.value.level;return I(e+1)}),S=g(()=>{if(!t.value)return 0;const e=t.value.level;return I(e)}),A=g(()=>{if(!t.value)return 0;const e=t.value.experience_points||0,o=S.value,a=D.value;if(console.log("è®¡ç®—ç»éªŒè¿›åº¦:",{currentExp:e,currentLevelReq:o,nextLevelReq:a,level:t.value.level}),e>=a)return 100;const l=a-e,_=e+l;if(console.log("è¿›åº¦è®¡ç®—:",{expNeededForNext:l,totalExpForProgress:_}),_<=0)return 0;const h=Math.floor(e/_*100);return console.log("æœ€ç»ˆè¿›åº¦:",h),Math.max(0,Math.min(100,h))}),O=e=>{const o=["æ–°æ‰‹","åˆçº§","ä¸­çº§","é«˜çº§","èµ„æ·±","ä¸“å®¶","å¤§å¸ˆ","å®—å¸ˆ","ä¼ å¥‡","å²è¯—","ç¥è¯","è‡³å°Š"];return e<=1?"æ–°æ‰‹":e>o.length?"è‡³å°Š":o[e-1]},$=g(()=>{var o;return(((o=t.value)==null?void 0:o.level)||1)>=3}),R=g(()=>{var a;const e=((a=t.value)==null?void 0:a.level)||1,o=[];return o.push({id:"basic",name:"å‘å¸–ã€è¯„è®ºã€ç‚¹èµ",icon:"ğŸ“"}),e>=3&&o.push({id:"avatar",name:"è‡ªå®šä¹‰å¤´åƒ",icon:"ğŸ–¼ï¸"}),e>=5&&o.push({id:"signature",name:"ä¸ªæ€§ç­¾å",icon:"âœï¸"}),e>=7&&o.push({id:"color",name:"ä¸ªæ€§åŒ–è‰²å½©",icon:"ğŸ¨"}),e>=10&&o.push({id:"mod",name:"è¯„è®ºç½®é¡¶æƒé™",icon:"â­"}),o});z(async()=>{await j()});const j=async()=>{console.log("å¼€å§‹åŠ è½½ç”¨æˆ·æ•°æ®..."),m.value=!0;try{if(v.value)console.log("åŠ è½½å…¶ä»–ç”¨æˆ·èµ„æ–™ï¼ŒID:",k.value),await Y();else{if(!c.user){console.warn("ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•åŠ è½½ä¸ªäººèµ„æ–™"),m.value=!1;return}if(console.log("ç”¨æˆ·å·²ç™»å½•ï¼ŒID:",c.user.id),c.profile)console.log("ç”¨æˆ·èµ„æ–™å·²å­˜åœ¨:",c.profile);else{console.log("ç”¨æˆ·èµ„æ–™ä¸ºç©ºï¼Œå°è¯•è·å–...");try{console.log("è°ƒç”¨fetchProfile..."),await c.fetchProfile(),console.log("fetchProfileå®Œæˆ")}catch(e){console.warn("åŠ è½½ç”¨æˆ·èµ„æ–™å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼:",e)}}console.log("å¼€å§‹åŠ è½½ç”¨æˆ·å¸–å­..."),await X(),console.log("ç”¨æˆ·å¸–å­åŠ è½½å®Œæˆ")}}catch(e){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}finally{console.log("è®¾ç½®loadingä¸ºfalse"),m.value=!1}},X=async()=>{if(!c.user){console.warn("ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•åŠ è½½ç”¨æˆ·å¸–å­"),p.value=[];return}try{const e=await f.fetchUserPosts(c.user.id);e.success?p.value=e.data||[]:(console.error("åŠ è½½ç”¨æˆ·å¸–å­å¤±è´¥:",e.error),p.value=[])}catch(e){console.error("åŠ è½½ç”¨æˆ·å¸–å­å¤±è´¥:",e),p.value=[]}},T=e=>{console.log("ç‚¹èµå¸–å­:",e)},Z=e=>{console.log("è¯„è®ºå¸–å­:",e)},G=async e=>{var o;try{n.value=!1,localStorage.setItem("userAvatar",e.id),t.value&&(t.value.avatar_url=e.id);const a="https://bkintupjzbcjiqvzricz.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJraW50dXBqemJjamlxdnpyaWN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2MDYzNDEsImV4cCI6MjA3NzE4MjM0MX0.ZA6l95LSZ_x2DFfJGCcXMXLlRg9nOV7kNqEJUC7OG8o";if(!a||!l||a.includes("default.supabase.co")||l.includes("default")){console.log("å¼€å‘æ¨¡å¼ï¼šå¤´åƒå·²æ›´æ–°åˆ°æœ¬åœ°çŠ¶æ€");return}const{supabase:_}=await B(async()=>{const{supabase:C}=await import("./index-02sh5J2l.js").then(H=>H.M);return{supabase:C}},__vite__mapDeps([0,1])),{error:h}=await _.from("profiles").update({avatar_url:e.id,updated_at:new Date().toISOString()}).eq("id",(o=c.user)==null?void 0:o.id);if(h){console.error("æ›´æ–°å¤´åƒå¤±è´¥:",h);const C=localStorage.getItem("userAvatar");t.value&&(t.value.avatar_url=C||null)}else console.log("å¤´åƒæ›´æ–°æˆåŠŸ")}catch(a){console.error("æ›´æ–°å¤´åƒå¤±è´¥:",a)}},Y=async()=>{try{const{supabase:e}=await B(async()=>{const{supabase:h}=await import("./index-02sh5J2l.js").then(C=>C.M);return{supabase:h}},__vite__mapDeps([0,1])),{data:o,error:a}=await e.from("profiles").select("*").eq("id",k.value).single();if(a){console.error("è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:",a),m.value=!1;return}d.value=o,console.log("å…¶ä»–ç”¨æˆ·èµ„æ–™åŠ è½½æˆåŠŸ:",o);const{data:l,error:_}=await e.from("posts").select("*").eq("user_id",k.value).order("created_at",{ascending:!1});_?console.error("è·å–ç”¨æˆ·å¸–å­å¤±è´¥:",_):p.value=l||[]}catch(e){console.error("åŠ è½½å…¶ä»–ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}finally{m.value=!1}},W=e=>e>=10?"level-10-plus":e>=7?"level-7-9":e>=4?"level-4-6":"level-1-3",N=()=>{t.value&&(console.log("Profile data:",t.value),console.log("Experience points:",t.value.experience_points),console.log("Level:",t.value.level),console.log("Current level exp:",S.value),console.log("Next level exp:",D.value),console.log("Progress:",A.value))},K=async()=>{await c.updateExperience(10),N()},Q=e=>e?new Date(e).toLocaleDateString("zh-CN"):"æœªçŸ¥æ—¶é—´";return(e,o)=>{const a=se("RouterLink");return r(),i("div",be,[s("header",ke,[s("div",xe,[s("div",ye,[b(a,{to:"/",class:"back-link"},{default:E(()=>[...o[3]||(o[3]=[x("â† è¿”å›é¦–é¡µ",-1)])]),_:1}),v.value?L("",!0):(r(),i("nav",Ce,[b(a,{to:"/profile",class:"nav-link active"},{default:E(()=>[...o[4]||(o[4]=[x("ä¸ªäººä¸­å¿ƒ",-1)])]),_:1}),b(a,{to:"/bookmarks",class:"nav-link"},{default:E(()=>[...o[5]||(o[5]=[s("i",{class:"bi bi-bookmark"},null,-1),x(" æ”¶è— ",-1)])]),_:1}),b(a,{to:"/messages",class:"nav-link"},{default:E(()=>[...o[6]||(o[6]=[s("i",{class:"bi bi-envelope"},null,-1),x(" æ¶ˆæ¯ ",-1)])]),_:1})]))]),s("h1",null,u(v.value?"ç”¨æˆ·èµ„æ–™":"ä¸ªäººä¸­å¿ƒ"),1)])]),s("main",Ee,[s("div",we,[m.value?(r(),i("div",De,"åŠ è½½ä¸­...")):t.value?(r(),i("div",Ie,[s("div",Ae,[s("div",Le,[s("div",{class:"avatar-container",onClick:o[0]||(o[0]=l=>!v.value&&$.value&&(n.value=!0))},[b(ie,{username:t.value.username,"avatar-id":t.value.avatar_url,size:"80px"},null,8,["username","avatar-id"]),!v.value&&$.value?(r(),i("div",Fe,[...o[7]||(o[7]=[s("span",null,"ç‚¹å‡»æ›´æ¢",-1)])])):v.value?L("",!0):(r(),i("div",Pe,[...o[8]||(o[8]=[s("span",null,"Lv.3 è§£é”",-1)])]))]),s("div",Se,[s("h2",{class:U(["username",W(t.value.level)])},[x(u(t.value.username)+" ",1),s("span",$e,"Lv."+u(t.value.level)+" "+u(O(t.value.level)),1)],2),s("p",Ne," æ³¨å†Œæ—¶é—´ï¼š"+u(Q(t.value.created_at)),1)])]),s("div",Be,[s("div",Me,[s("span",null,"ç»éªŒå€¼ï¼š"+u(t.value.experience_points||0),1),s("span",null,"ä¸‹ä¸€ç­‰çº§ï¼š"+u(D.value-(t.value.experience_points||0)>0?D.value-(t.value.experience_points||0)+" EXP":"å·²æ»¡"),1),s("button",{onClick:N,class:"debug-btn",title:"è°ƒè¯•ç»éªŒå€¼"}," è°ƒè¯• ")]),s("div",ze,[s("div",{class:"exp-bar",style:V({width:A.value+"%"})},null,4),s("span",Ue,u(A.value)+"%",1)]),s("div",{class:"exp-debug"},[s("button",{onClick:K,class:"test-btn"}," æµ‹è¯•+10ç»éªŒ ")])]),s("div",Ve,[o[9]||(o[9]=s("h3",null,"å½“å‰ç‰¹æƒ",-1)),s("div",Je,[(r(!0),i(F,null,P(R.value,l=>(r(),i("div",{key:l.id,class:"privilege-item"},[s("span",qe,u(l.icon),1),s("span",Oe,u(l.name),1)]))),128))])])]),s("div",Re,[o[12]||(o[12]=s("h3",null,"æˆ‘çš„å¸–å­",-1)),p.value.length>0?(r(),i("div",je,[(r(!0),i(F,null,P(p.value,l=>(r(),ae(re,{key:l.id,post:l,onLike:T,onComment:Z},null,8,["post"]))),128))])):(r(),i("div",Xe,[o[11]||(o[11]=s("p",null,"è¿˜æ²¡æœ‰å‘å¸ƒè¿‡å¸–å­",-1)),b(a,{to:"/",class:"btn-primary"},{default:E(()=>[...o[10]||(o[10]=[x("å»å‘å¸ƒç¬¬ä¸€ä¸ªå¸–å­",-1)])]),_:1})]))])])):(r(),i("div",Te,[...o[13]||(o[13]=[s("p",null,"ç”¨æˆ·ä¿¡æ¯åŠ è½½å¤±è´¥",-1)])]))])]),n.value?(r(),i("div",{key:0,class:"modal-overlay",onClick:o[2]||(o[2]=te(l=>n.value=!1,["self"]))},[s("div",Ze,[b(he,{onClose:o[1]||(o[1]=l=>n.value=!1),onSelect:G})])])):L("",!0)])}}}),so=J(Ge,[["__scopeId","data-v-f69881ac"]]);export{so as default};
//# sourceMappingURL=ProfileView-xPtkhRfl.js.map
