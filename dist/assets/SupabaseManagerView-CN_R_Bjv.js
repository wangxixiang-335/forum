import{d as B,r as d,c as p,i as L,a as l,b as s,g as r,t as n,n as v,u as z,F as y,h as k,z as O,A as $,B as D,x as C,o as i,_ as T}from"./index-02sh5J2l.js";const X={class:"supabase-manager"},F={class:"container"},P={class:"project-info"},Y={class:"info-grid"},Z={class:"info-item"},q={class:"info-item"},G={class:"info-item"},K={class:"info-item"},W={class:"config-section"},Q=["disabled"],H={key:0,class:"validation-result"},ss={key:0,class:"issues"},es={class:"issue-icon"},ts={class:"issue-content"},as={key:0,class:"issue-field"},ns={key:1,class:"issue-fix"},os={key:1,class:"recommendations"},ls={class:"database-section"},is={class:"database-status"},cs={class:"tables-grid"},us={class:"table-icon"},rs={class:"table-name"},ds={class:"table-row-count"},vs={class:"migration-controls"},bs={class:"buttons"},ps=["disabled"],ms={key:0,class:"migration-result"},_s={key:0,class:"migration-details"},fs={key:0,class:"connection-test-result"},gs=B({__name:"SupabaseManagerView",setup(hs){const m=d(!1),o=d(null),_=d(!1),c=d(null),I=d([]),u=d(""),b="https://bkintupjzbcjiqvzricz.supabase.co",S="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJraW50dXBqemJjamlxdnpyaWN6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE2MDYzNDEsImV4cCI6MjA3NzE4MjM0MX0.ZA6l95LSZ_x2DFfJGCcXMXLlRg9nOV7kNqEJUC7OG8o",f=p(()=>{const t=b.match(/https:\/\/([^.]+)\.supabase\.co/);return t?t[1]:null}),E=p(()=>!b.includes("default.supabase.co")),V=p(()=>"production"),x=p(()=>o.value?o.value.isValid?"connected":"disconnected":"unknown"),U=p(()=>o.value?o.value.isValid?"已连接":"连接失败":"未验证"),A=t=>{switch(t){case"error":return"❌";case"warning":return"⚠️";case"info":return"ℹ️";default:return"❓"}},w=async()=>{m.value=!0,o.value=null;try{o.value=await O(),console.log("🔧 配置验证完成:",o.value)}catch(t){console.error("❌ 配置验证失败:",t),o.value={isValid:!1,issues:[{type:"error",message:"配置验证异常: "+(t instanceof Error?t.message:"未知错误")}],recommendations:["请检查控制台错误信息"]}}finally{m.value=!1}},N=async()=>{_.value=!0,c.value=null;try{c.value=await $(),console.log("🚀 迁移执行完成:",c.value),await g()}catch(t){console.error("❌ 迁移执行失败:",t),c.value={success:!1,message:"迁移执行异常: "+(t instanceof Error?t.message:"未知错误")}}finally{_.value=!1}},g=async()=>{try{const t=await D();I.value=t.tables,console.log("📊 数据库状态检查完成:",t)}catch(t){console.error("❌ 数据库状态检查失败:",t)}},j=async()=>{try{u.value=`🔗 开始连接测试...
`;const{data:t,error:e}=await C.auth.getSession();u.value+=`认证测试: ${e?"失败":"成功"}
`,e?u.value+=`错误: ${e.message}
`:u.value+=`会话状态: ${t.session?"已登录":"未登录"}
`;const{error:a}=await C.from("profiles").select("count").limit(1);u.value+=`数据库测试: ${a?"失败":"成功"}
`,a&&(u.value+=`错误: ${a.message}
`),u.value+="✅ 连接测试完成"}catch(t){u.value=`❌ 连接测试异常: ${t.message}`}},J=()=>{f.value?window.open(`https://supabase.com/dashboard/project/${f.value}`,"_blank"):window.open("https://supabase.com/dashboard","_blank")},M=()=>{const t={VITE_SUPABASE_URL:b,VITE_SUPABASE_ANON_KEY:S};navigator.clipboard.writeText(JSON.stringify(t,null,2)),alert("配置已复制到剪贴板")},R=()=>{const t=`VITE_SUPABASE_URL=${b}
VITE_SUPABASE_ANON_KEY=${S}`,e=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(e),h=document.createElement("a");h.href=a,h.download="supabase-config.env",h.click(),URL.revokeObjectURL(a)};return L(async()=>{console.log("🔧 Supabase管理器已加载"),await w(),await g()}),(t,e)=>(i(),l("div",X,[s("div",F,[e[12]||(e[12]=s("h1",null,"🔧 Supabase项目管理器",-1)),s("div",P,[e[4]||(e[4]=s("h2",null,"项目信息",-1)),s("div",Y,[s("div",Z,[e[0]||(e[0]=s("label",null,"项目ID:",-1)),s("span",null,n(f.value||"未配置"),1)]),s("div",q,[e[1]||(e[1]=s("label",null,"API URL:",-1)),s("span",{class:v({valid:E.value})},n(z(b)||"未配置"),3)]),s("div",G,[e[2]||(e[2]=s("label",null,"环境:",-1)),s("span",null,n(V.value),1)]),s("div",K,[e[3]||(e[3]=s("label",null,"连接状态:",-1)),s("span",{class:v(x.value)},n(U.value),3)])])]),s("div",W,[e[6]||(e[6]=s("h2",null,"配置验证",-1)),s("button",{onClick:w,disabled:m.value,class:"validate-btn"},n(m.value?"验证中...":"验证配置"),9,Q),o.value?(i(),l("div",H,[s("h3",{class:v({success:o.value.isValid,error:!o.value.isValid})},n(o.value.isValid?"✅ 验证通过":"❌ 验证失败"),3),o.value.issues.length>0?(i(),l("div",ss,[(i(!0),l(y,null,k(o.value.issues,a=>(i(),l("div",{key:a.message,class:v(["issue",a.type])},[s("span",es,n(A(a.type)),1),s("div",ts,[s("strong",null,n(a.message),1),a.field?(i(),l("div",as,"字段: "+n(a.field),1)):r("",!0),a.fix?(i(),l("div",ns,"💡 "+n(a.fix),1)):r("",!0)])],2))),128))])):r("",!0),o.value.recommendations.length>0?(i(),l("div",os,[e[5]||(e[5]=s("h4",null,"建议:",-1)),s("ul",null,[(i(!0),l(y,null,k(o.value.recommendations,a=>(i(),l("li",{key:a},n(a),1))),128))])])):r("",!0)])):r("",!0)]),s("div",ls,[e[9]||(e[9]=s("h2",null,"数据库管理",-1)),s("div",is,[e[7]||(e[7]=s("h3",null,"表状态",-1)),s("div",cs,[(i(!0),l(y,null,k(I.value,a=>(i(),l("div",{key:a.name,class:v(["table-item",{exists:a.exists}])},[s("span",us,n(a.exists?"✅":"❌"),1),s("span",rs,n(a.name),1),s("span",ds,n(a.rowCount)+" 行",1)],2))),128))])]),s("div",vs,[e[8]||(e[8]=s("h3",null,"迁移操作",-1)),s("div",bs,[s("button",{onClick:N,disabled:_.value,class:"migration-btn"},n(_.value?"执行中...":"执行迁移"),9,ps),s("button",{onClick:g,class:"check-btn"},"检查数据库")]),c.value?(i(),l("div",ms,[s("h4",{class:v({success:c.value.success,error:!c.value.success})},n(c.value.success?"✅ 迁移成功":"❌ 迁移失败"),3),s("p",null,n(c.value.message),1),c.value.details?(i(),l("div",_s,[s("pre",null,n(c.value.details),1)])):r("",!0)])):r("",!0)])]),s("div",{class:"quick-actions"},[e[10]||(e[10]=s("h2",null,"快速操作",-1)),s("div",{class:"action-buttons"},[s("button",{onClick:J,class:"action-btn"}," 📊 打开控制台 "),s("button",{onClick:M,class:"action-btn"}," 📋 复制配置 "),s("button",{onClick:R,class:"action-btn"}," 📁 导出配置 "),s("button",{onClick:j,class:"action-btn"}," 🔗 测试连接 ")])]),u.value?(i(),l("div",fs,[e[11]||(e[11]=s("h3",null,"连接测试结果",-1)),s("pre",null,n(u.value),1)])):r("",!0)])]))}}),ks=T(gs,[["__scopeId","data-v-697c8802"]]);export{ks as default};
//# sourceMappingURL=SupabaseManagerView-CN_R_Bjv.js.map
