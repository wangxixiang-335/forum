{"version":3,"file":"auth-DsvB8qh0.js","sources":["../../src/utils/profileManager.ts","../../src/stores/auth.ts"],"sourcesContent":["import { supabase } from '@/services/supabase'\r\nimport type { User } from '@supabase/supabase-js'\r\n\r\n/**\r\n * ç”¨æˆ·èµ„æ–™ç®¡ç†å™¨\r\n */\r\n\r\n/**\r\n * ç¡®ä¿ç”¨æˆ·èµ„æ–™å­˜åœ¨\r\n */\r\nexport async function ensureProfileExists(user: User): Promise<{\r\n  success: boolean\r\n  profile?: any\r\n  created?: boolean\r\n  error?: string\r\n}> {\r\n  try {\r\n    console.log('ğŸ‘¤ æ£€æŸ¥ç”¨æˆ·èµ„æ–™æ˜¯å¦å­˜åœ¨...', user.id)\r\n    \r\n    // é¦–å…ˆå°è¯•è·å–ç°æœ‰èµ„æ–™\r\n    const { data: existingProfile, error: fetchError } = await supabase\r\n      .from('profiles')\r\n      .select('*')\r\n      .eq('id', user.id)\r\n      .single()\r\n    \r\n    if (fetchError) {\r\n      // å¦‚æœæ˜¯\"æœªæ‰¾åˆ°è®°å½•\"çš„é”™è¯¯ï¼Œç»§ç»­åˆ›å»ºæ–°èµ„æ–™\r\n      if (fetchError.code === 'PGRST116') {\r\n        console.log('ğŸ“­ ç”¨æˆ·èµ„æ–™ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºæ–°èµ„æ–™')\r\n      } else {\r\n        // å…¶ä»–é”™è¯¯ï¼ˆå¦‚406ã€403ç­‰ï¼‰å¯èƒ½æ˜¯RLSç­–ç•¥é—®é¢˜\r\n        console.warn('âš ï¸ è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', fetchError.message)\r\n        \r\n        // RLSç­–ç•¥é—®é¢˜æ—¶ç›´æ¥ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®\r\n        if (fetchError.status === 406 || fetchError.status === 403 || fetchError.message.includes('permission') || fetchError.message.includes('row-level security')) {\r\n          const mockProfile = {\r\n            id: user.id,\r\n            username: user.user_metadata?.username || user.email?.split('@')[0] || `user_${user.id.slice(0, 8)}`,\r\n            avatar_url: null,\r\n            level: 1,\r\n            experience_points: 0,\r\n            created_at: new Date().toISOString()\r\n          }\r\n          mockProfiles.set(user.id, mockProfile)\r\n          console.log('ğŸ”§ ä½¿ç”¨æ¨¡æ‹Ÿèµ„æ–™ï¼ˆè·å–ç”¨æˆ·èµ„æ–™æ—¶é‡åˆ°RLSé—®é¢˜ï¼‰')\r\n          return { success: true, profile: mockProfile, created: false }\r\n        }\r\n        \r\n        // å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®\r\n        if (import.meta.env.DEV) {\r\n          const mockProfile = getMockProfile(user.id)\r\n          if (mockProfile) {\r\n            console.log('ğŸ”§ ä½¿ç”¨å¼€å‘æ¨¡å¼æ¨¡æ‹Ÿèµ„æ–™')\r\n            return { success: true, profile: mockProfile, created: false }\r\n          }\r\n        }\r\n        \r\n        // éå¼€å‘æ¨¡å¼æˆ–æ²¡æœ‰æ¨¡æ‹Ÿæ•°æ®æ—¶æŠ›å‡ºé”™è¯¯\r\n        throw fetchError\r\n      }\r\n    }\r\n    \r\n    if (existingProfile) {\r\n      console.log('âœ… ç”¨æˆ·èµ„æ–™å·²å­˜åœ¨')\r\n      return { success: true, profile: existingProfile, created: false }\r\n    }\r\n    \r\n    // èµ„æ–™ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°èµ„æ–™\r\n    console.log('â• åˆ›å»ºæ–°ç”¨æˆ·èµ„æ–™...')\r\n    \r\n    const username = user.user_metadata?.username || \r\n                    user.email?.split('@')[0] || \r\n                    `user_${user.id.slice(0, 8)}`\r\n    \r\n    const profileData = {\r\n      id: user.id,\r\n      username: username,\r\n      avatar_url: null,\r\n      level: 1,\r\n      experience_points: 0,\r\n      created_at: new Date().toISOString()\r\n    }\r\n    \r\n    const { data: newProfile, error: createError } = await supabase\r\n      .from('profiles')\r\n      .insert(profileData)\r\n      .select()\r\n      .single()\r\n    \r\n    if (createError) {\r\n      // å¦‚æœæ˜¯å”¯ä¸€çº¦æŸå†²çªï¼ˆç”¨æˆ·åå·²å­˜åœ¨ï¼‰ï¼Œå°è¯•å…¶ä»–ç”¨æˆ·å\r\n      if (createError.code === '23505' && createError.message.includes('username')) {\r\n        console.log('ğŸ”„ ç”¨æˆ·åå†²çªï¼Œå°è¯•ç”Ÿæˆå”¯ä¸€ç”¨æˆ·å...')\r\n        \r\n        const uniqueUsername = `${username}_${Date.now().toString().slice(-4)}`\r\n        profileData.username = uniqueUsername\r\n        \r\n        const { data: retryProfile, error: retryError } = await supabase\r\n          .from('profiles')\r\n          .insert(profileData)\r\n          .select()\r\n          .single()\r\n        \r\n        if (retryError) {\r\n          throw retryError\r\n        }\r\n        \r\n        console.log('âœ… ç”¨æˆ·èµ„æ–™åˆ›å»ºæˆåŠŸï¼ˆä½¿ç”¨å”¯ä¸€ç”¨æˆ·åï¼‰')\r\n        return { success: true, profile: retryProfile, created: true }\r\n      }\r\n      \r\n      // å¤„ç†RLSç­–ç•¥é”™è¯¯ï¼ˆ403ï¼‰æˆ–å…¶ä»–æƒé™é”™è¯¯\r\n      if (createError.code === '42501' || createError.message.includes('permission') || createError.status === 403 || createError.message.includes('row-level security')) {\r\n        console.warn('ğŸ”’ æƒé™ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·èµ„æ–™:', createError.message)\r\n        \r\n        // æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ¡ˆ\r\n        const errorDetails = {\r\n          message: 'æ•°æ®åº“æƒé™å—é™ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·èµ„æ–™',\r\n          solution: 'è¯·æ£€æŸ¥Supabase RLSç­–ç•¥é…ç½®',\r\n          errorCode: createError.code,\r\n          status: createError.status\r\n        }\r\n        \r\n        console.error('âŒ RLSç­–ç•¥é”™è¯¯è¯¦æƒ…:', errorDetails)\r\n        \r\n        // ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šå§‹ç»ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œç›´åˆ°RLSç­–ç•¥ä¿®å¤\r\n        const mockProfile = {\r\n          id: user.id,\r\n          username: username,\r\n          avatar_url: null,\r\n          level: 1,\r\n          experience_points: 0,\r\n          created_at: new Date().toISOString()\r\n        }\r\n        mockProfiles.set(user.id, mockProfile)\r\n        console.log('ğŸ”§ ä½¿ç”¨æ¨¡æ‹Ÿèµ„æ–™ï¼ˆRLSç­–ç•¥é—®é¢˜ï¼Œä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼‰')\r\n        return { \r\n          success: true, \r\n          profile: mockProfile, \r\n          created: true,\r\n          warning: 'ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆRLSç­–ç•¥éœ€è¦ä¿®å¤ï¼‰'\r\n        }\r\n      }\r\n      \r\n      throw createError\r\n    }\r\n    \r\n    console.log('âœ… ç”¨æˆ·èµ„æ–™åˆ›å»ºæˆåŠŸ')\r\n    return { success: true, profile: newProfile, created: true }\r\n    \r\n  } catch (error: any) {\r\n    console.error('âŒ ç¡®ä¿ç”¨æˆ·èµ„æ–™å­˜åœ¨å¤±è´¥:', error)\r\n    return { \r\n      success: false, \r\n      error: error.message,\r\n      created: false \r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * è·å–æˆ–åˆ›å»ºç”¨æˆ·èµ„æ–™\r\n */\r\nexport async function getOrCreateProfile(user: User): Promise<any> {\r\n  const result = await ensureProfileExists(user)\r\n  \r\n  if (!result.success) {\r\n    throw new Error(`æ— æ³•è·å–æˆ–åˆ›å»ºç”¨æˆ·èµ„æ–™: ${result.error}`)\r\n  }\r\n  \r\n  return result.profile\r\n}\r\n\r\n/**\r\n * æ›´æ–°ç”¨æˆ·èµ„æ–™\r\n */\r\nexport async function updateProfile(userId: string, updates: Partial<{\r\n  username: string\r\n  avatar_url: string | null\r\n  level: number\r\n  experience_points: number\r\n}>): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const { error } = await supabase\r\n      .from('profiles')\r\n      .update({\r\n        ...updates,\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .eq('id', userId)\r\n    \r\n    if (error) {\r\n      throw error\r\n    }\r\n    \r\n    return { success: true }\r\n  } catch (error: any) {\r\n    console.error('âŒ æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥:', error)\r\n    return { success: false, error: error.message }\r\n  }\r\n}\r\n\r\n/**\r\n * æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦å­˜åœ¨\r\n */\r\nexport async function checkProfilesTableExists(): Promise<boolean> {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('profiles')\r\n      .select('count')\r\n      .limit(1)\r\n    \r\n    // å¦‚æœæ²¡æœ‰é”™è¯¯æˆ–è€…é”™è¯¯æ˜¯\"è¡¨ä¸å­˜åœ¨\"ï¼Œè¿”å›ç›¸åº”ç»“æœ\r\n    if (!error) return true\r\n    if (error.code === '42P01') return false // è¡¨ä¸å­˜åœ¨\r\n    \r\n    // å¤„ç†æƒé™é”™è¯¯ï¼ˆ403/406ï¼‰\r\n    if (error.status === 403 || error.status === 406) {\r\n      console.warn('ğŸ”’ æ£€æŸ¥è¡¨å­˜åœ¨æ—¶æƒé™å—é™ï¼Œå‡è®¾è¡¨å­˜åœ¨')\r\n      return true\r\n    }\r\n    \r\n    throw error\r\n  } catch (error: any) {\r\n    console.error('âŒ æ£€æŸ¥profilesè¡¨å¤±è´¥:', error)\r\n    \r\n    // å¼€å‘æ¨¡å¼ä¸‹å‡è®¾è¡¨å­˜åœ¨\r\n    if (import.meta.env.DEV) {\r\n      console.warn('ğŸ”§ å¼€å‘æ¨¡å¼ä¸‹å‡è®¾profilesè¡¨å­˜åœ¨')\r\n      return true\r\n    }\r\n    \r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ç”¨æˆ·èµ„æ–™\r\n */\r\nexport async function autoCreateMissingProfiles(): Promise<void> {\r\n  try {\r\n    console.log('ğŸ” æ£€æŸ¥å¹¶åˆ›å»ºç¼ºå¤±çš„ç”¨æˆ·èµ„æ–™...')\r\n    \r\n    // è·å–å½“å‰ä¼šè¯ç”¨æˆ·\r\n    const { data: { session } } = await supabase.auth.getSession()\r\n    \r\n    if (!session?.user) {\r\n      console.log('ğŸ” æ²¡æœ‰ç™»å½•ç”¨æˆ·ï¼Œè·³è¿‡èµ„æ–™åˆ›å»º')\r\n      return\r\n    }\r\n    \r\n    // æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨\r\n    const tableExists = await checkProfilesTableExists()\r\n    if (!tableExists) {\r\n      console.warn('âš ï¸ profilesè¡¨ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ›å»ºç”¨æˆ·èµ„æ–™')\r\n      return\r\n    }\r\n    \r\n    // ç¡®ä¿å½“å‰ç”¨æˆ·èµ„æ–™å­˜åœ¨\r\n    const result = await ensureProfileExists(session.user)\r\n    \r\n    if (result.success) {\r\n      if (result.created) {\r\n        console.log('âœ… å·²ä¸ºæ–°ç”¨æˆ·åˆ›å»ºèµ„æ–™')\r\n      } else {\r\n        console.log('âœ… ç”¨æˆ·èµ„æ–™å·²å­˜åœ¨')\r\n      }\r\n    } else {\r\n      console.error('âŒ åˆ›å»ºç”¨æˆ·èµ„æ–™å¤±è´¥:', result.error)\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('âŒ è‡ªåŠ¨åˆ›å»ºç”¨æˆ·èµ„æ–™å¤±è´¥:', error)\r\n  }\r\n}\r\n\r\n/**\r\n * ç”¨æˆ·èµ„æ–™ç›‘å¬å™¨\r\n */\r\nexport function setupProfileListeners(): void {\r\n  // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–\r\n  supabase.auth.onAuthStateChange(async (event, session) => {\r\n    if (event === 'SIGNED_IN' && session?.user) {\r\n      console.log('ğŸ” ç”¨æˆ·ç™»å½•ï¼Œæ£€æŸ¥èµ„æ–™...')\r\n      \r\n      // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿å…¶ä»–åˆå§‹åŒ–å®Œæˆ\r\n      setTimeout(() => {\r\n        autoCreateMissingProfiles().catch(console.error)\r\n      }, 1000)\r\n    }\r\n  })\r\n}\r\n\r\n// å¼€å‘æ¨¡å¼ä¸‹çš„æ¨¡æ‹Ÿèµ„æ–™\r\nconst mockProfiles = new Map<string, any>()\r\n\r\n/**\r\n * å¼€å‘æ¨¡å¼ä¸‹çš„æ¨¡æ‹Ÿèµ„æ–™ç®¡ç†\r\n */\r\nexport function setupMockProfiles(): void {\r\n  if (!import.meta.env.DEV) return\r\n  \r\n  console.log('ğŸ”§ è®¾ç½®å¼€å‘æ¨¡å¼ä¸‹çš„æ¨¡æ‹Ÿç”¨æˆ·èµ„æ–™...')\r\n  \r\n  // æ·»åŠ ä¸€äº›æ¨¡æ‹Ÿç”¨æˆ·èµ„æ–™\r\n  mockProfiles.set('dev-user-id', {\r\n    id: 'dev-user-id',\r\n    username: 'devuser',\r\n    avatar_url: null,\r\n    level: 1,\r\n    experience_points: 0,\r\n    created_at: new Date().toISOString()\r\n  })\r\n  \r\n  mockProfiles.set('af216c8a-e67b-478f-ac60-e798fbc09298', {\r\n    id: 'af216c8a-e67b-478f-ac60-e798fbc09298',\r\n    username: '1724045101',\r\n    avatar_url: null,\r\n    level: 1,\r\n    experience_points: 0,\r\n    created_at: new Date().toISOString()\r\n  })\r\n}\r\n\r\n/**\r\n * è·å–æ¨¡æ‹Ÿç”¨æˆ·èµ„æ–™\r\n */\r\nexport function getMockProfile(userId: string): any | null {\r\n  return mockProfiles.get(userId) || null\r\n}\r\n\r\n/**\r\n * åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™ç³»ç»Ÿ\r\n */\r\nexport async function initializeProfileSystem(): Promise<void> {\r\n  console.log('ğŸ‘¤ åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™ç³»ç»Ÿ...')\r\n  \r\n  // å¼€å‘æ¨¡å¼ä¸‹è®¾ç½®æ¨¡æ‹Ÿèµ„æ–™\r\n  if (import.meta.env.DEV) {\r\n    setupMockProfiles()\r\n  }\r\n  \r\n  // è®¾ç½®èµ„æ–™ç›‘å¬å™¨\r\n  setupProfileListeners()\r\n  \r\n  // æ£€æŸ¥å¹¶åˆ›å»ºå½“å‰ç”¨æˆ·çš„èµ„æ–™\r\n  await autoCreateMissingProfiles()\r\n  \r\n  console.log('âœ… ç”¨æˆ·èµ„æ–™ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ')\r\n}","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { supabase } from '@/services/supabase'\r\nimport type { User } from '@supabase/supabase-js'\r\nimport { \r\n  ensureProfileExists, \r\n  getMockProfile, \r\n  checkProfilesTableExists \r\n} from '@/utils/profileManager'\r\n\r\ninterface Profile {\r\n  id: string\r\n  username: string\r\n  avatar_url: string | null\r\n  level: number\r\n  experience_points: number\r\n  created_at: string\r\n}\r\n\r\nexport const useAuthStore = defineStore('auth', () => {\r\n  const user = ref<User | null>(null)\r\n  const profile = ref<Profile | null>(null)\r\n  const isLoading = ref(false)\r\n\r\n  const isAuthenticated = computed(() => !!user.value)\r\n  const currentLevel = computed(() => profile.value?.level || 1)\r\n  const experiencePoints = computed(() => profile.value?.experience_points || 0)\r\n\r\n  // åˆå§‹åŒ–è®¤è¯çŠ¶æ€\r\n  const initializeAuth = async () => {\r\n    try {\r\n      console.log('å¼€å§‹åˆå§‹åŒ–è®¤è¯çŠ¶æ€...')\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨é»˜è®¤é…ç½®\r\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL\r\n      if (!supabaseUrl || supabaseUrl.includes('default.supabase.co')) {\r\n        console.log('ä½¿ç”¨é»˜è®¤Supabaseé…ç½®ï¼Œåˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·')\r\n        // åˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·ç”¨äºå¼€å‘\r\n        user.value = {\r\n          id: 'dev-user-id',\r\n          email: 'dev@example.com',\r\n          user_metadata: { username: 'devuser' }\r\n        } as any\r\n        \r\n        profile.value = {\r\n          id: 'dev-user-id',\r\n          username: 'devuser',\r\n          avatar_url: null,\r\n          level: 1,\r\n          experience_points: 0,\r\n          created_at: new Date().toISOString()\r\n        }\r\n        \r\n        console.log('å¼€å‘æ¨¡å¼è®¤è¯åˆå§‹åŒ–å®Œæˆ')\r\n        return\r\n      }\r\n      \r\n      const { data: { session }, error } = await supabase.auth.getSession()\r\n      \r\n      if (error) {\r\n        console.error('è·å–sessionå¤±è´¥:', error)\r\n        return\r\n      }\r\n      \r\n      if (session?.user) {\r\n        console.log('æ‰¾åˆ°æœ‰æ•ˆsessionï¼Œç”¨æˆ·ID:', session.user.id)\r\n        user.value = session.user\r\n        await fetchProfile()\r\n        console.log('è®¤è¯åˆå§‹åŒ–å®Œæˆ')\r\n      } else {\r\n        console.log('æœªæ‰¾åˆ°æœ‰æ•ˆsession')\r\n      }\r\n    } catch (error) {\r\n      console.warn('è®¤è¯åˆå§‹åŒ–å¤±è´¥:', error)\r\n    }\r\n  }\r\n\r\n  // è·å–ç”¨æˆ·èµ„æ–™\r\n  const fetchProfile = async () => {\r\n    if (!user.value) {\r\n      console.warn('fetchProfile: ç”¨æˆ·æœªç™»å½•')\r\n      return\r\n    }\r\n    \r\n    try {\r\n      // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨é»˜è®¤é…ç½®\r\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL\r\n      const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY\r\n      \r\n      if (!supabaseUrl || !supabaseKey || \r\n          supabaseUrl.includes('default.supabase.co') || \r\n          supabaseKey.includes('default')) {\r\n        // å¼€å‘æ¨¡å¼ï¼šä½¿ç”¨æ¨¡æ‹Ÿèµ„æ–™\r\n        console.log('ä½¿ç”¨å¼€å‘æ¨¡å¼æ¨¡æ‹Ÿèµ„æ–™')\r\n        profile.value = {\r\n          id: user.value.id,\r\n          username: user.value.user_metadata?.username || 'user',\r\n          avatar_url: null,\r\n          level: 1,\r\n          experience_points: 25,\r\n          created_at: new Date().toISOString()\r\n        }\r\n        return\r\n      }\r\n      \r\n      // çœŸå®ç¯å¢ƒï¼šå°è¯•è·å–èµ„æ–™ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º\r\n      const profileResult = await ensureProfileExists(user.value)\r\n      \r\n      if (profileResult.success && profileResult.profile) {\r\n        profile.value = profileResult.profile\r\n        console.log('âœ… ç”¨æˆ·èµ„æ–™è·å–/åˆ›å»ºæˆåŠŸ')\r\n      } else {\r\n        console.warn('âš ï¸ ç”¨æˆ·èµ„æ–™è·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤èµ„æ–™:', profileResult.error)\r\n        \r\n        // æ£€æŸ¥æ˜¯å¦æ˜¯æƒé™é—®é¢˜ï¼ˆ403/406é”™è¯¯ï¼‰\r\n        if (profileResult.error && (profileResult.error.includes('403') || profileResult.error.includes('406') || profileResult.error.includes('permission'))) {\r\n          console.warn('ğŸ”’ æ•°æ®åº“æƒé™å—é™ï¼Œä½¿ç”¨æœ¬åœ°èµ„æ–™æ¨¡å¼')\r\n        }\r\n        \r\n        // ä½¿ç”¨é»˜è®¤èµ„æ–™\r\n        profile.value = {\r\n          id: user.value.id,\r\n          username: user.value.email?.split('@')[0] || user.value.user_metadata?.username || 'user',\r\n          avatar_url: null,\r\n          level: 1,\r\n          experience_points: 0,\r\n          created_at: new Date().toISOString()\r\n        }\r\n      }\r\n      \r\n    } catch (error: any) {\r\n      console.error('âŒ è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', error)\r\n      \r\n      // å‡ºé”™æ—¶ä½¿ç”¨é»˜è®¤èµ„æ–™ï¼Œç¡®ä¿ä¸ä¼šå› ä¸ºèµ„æ–™åŠ è½½å¤±è´¥è€Œé˜»å¡é¡µé¢\r\n      profile.value = {\r\n        id: user.value.id,\r\n        username: user.value.email?.split('@')[0] || user.value.user_metadata?.username || 'user',\r\n        avatar_url: null,\r\n        level: 1,\r\n        experience_points: 0,\r\n        created_at: new Date().toISOString()\r\n      }\r\n      \r\n      // ä¸æŠ›å‡ºé”™è¯¯ï¼Œè®©é¡µé¢ç»§ç»­åŠ è½½\r\n    }\r\n  }\r\n\r\n  // ç™»å½•\r\n  const signIn = async (email: string, password: string) => {\r\n    isLoading.value = true\r\n    try {\r\n      // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨é»˜è®¤é…ç½®æˆ–æ•°æ®åº“æœªå°±ç»ª\r\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL\r\n      const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY\r\n      \r\n      // å¦‚æœé…ç½®æ— æ•ˆï¼Œä½¿ç”¨å¼€å‘æ¨¡å¼æ¨¡æ‹Ÿ\r\n      if (!supabaseUrl || !supabaseKey || \r\n          supabaseUrl.includes('default.supabase.co') || \r\n          supabaseKey.includes('default')) {\r\n        console.warn('å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿç™»å½•æµç¨‹ï¼ˆçœŸå®Supabaseé…ç½®æ— æ•ˆï¼‰')\r\n        \r\n        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®\r\n        user.value = {\r\n          id: 'dev-user-id',\r\n          email: email,\r\n          user_metadata: { username: 'devuser' }\r\n        } as any\r\n        \r\n        profile.value = {\r\n          id: 'dev-user-id',\r\n          username: 'devuser',\r\n          avatar_url: null,\r\n          level: 1,\r\n          experience_points: 0,\r\n          created_at: new Date().toISOString()\r\n        }\r\n        \r\n        return { success: true }\r\n      }\r\n      \r\n      // çœŸå®ç¯å¢ƒï¼šè°ƒç”¨Supabaseè®¤è¯\r\n      console.log('ğŸ” å°è¯•çœŸå®Supabaseç™»å½•...')\r\n      const { data, error } = await supabase.auth.signInWithPassword({\r\n        email,\r\n        password\r\n      })\r\n      \r\n      if (error) {\r\n        console.error('Supabaseç™»å½•é”™è¯¯:', error)\r\n        \r\n        // å¦‚æœæ˜¯é…ç½®é—®é¢˜ï¼Œå›é€€åˆ°å¼€å‘æ¨¡å¼\r\n        if (error.status === 400 || error.message.includes('Invalid')) {\r\n          console.warn('Supabaseé…ç½®æ— æ•ˆï¼Œå›é€€åˆ°å¼€å‘æ¨¡å¼')\r\n          \r\n          // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®\r\n          user.value = {\r\n            id: 'dev-user-id',\r\n            email: email,\r\n            user_metadata: { username: 'devuser' }\r\n          } as any\r\n          \r\n          profile.value = {\r\n            id: 'dev-user-id',\r\n            username: 'devuser',\r\n            avatar_url: null,\r\n            level: 1,\r\n            experience_points: 0,\r\n            created_at: new Date().toISOString()\r\n          }\r\n          \r\n          return { success: true }\r\n        }\r\n        \r\n        throw error\r\n      }\r\n      \r\n      if (data.user) {\r\n        user.value = data.user\r\n        await fetchProfile()\r\n        console.log('âœ… çœŸå®Supabaseç™»å½•æˆåŠŸ')\r\n      }\r\n      \r\n      return { success: true }\r\n    } catch (error: any) {\r\n      console.error('ç™»å½•é”™è¯¯:', error)\r\n      return { success: false, error: error.message }\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  // æ³¨å†Œ\r\n  const signUp = async (email: string, password: string, username: string) => {\r\n    isLoading.value = true\r\n    try {\r\n      // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨é»˜è®¤é…ç½®æˆ–æ•°æ®åº“æœªå°±ç»ª\r\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL\r\n      const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY\r\n      \r\n      // å¦‚æœé…ç½®æ— æ•ˆï¼Œä½¿ç”¨å¼€å‘æ¨¡å¼æ¨¡æ‹Ÿ\r\n      if (!supabaseUrl || !supabaseKey || \r\n          supabaseUrl.includes('default.supabase.co') || \r\n          supabaseKey.includes('default')) {\r\n        console.warn('å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿæ³¨å†Œæµç¨‹ï¼ˆçœŸå®Supabaseé…ç½®æ— æ•ˆï¼‰')\r\n        \r\n        // å¼€å‘æ¨¡å¼ä¸‹åˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·èµ„æ–™\r\n        const mockUser = {\r\n          id: 'mock-' + Date.now(),\r\n          email: email,\r\n          user_metadata: { username }\r\n        }\r\n        \r\n        // ç¡®ä¿æ¨¡æ‹Ÿèµ„æ–™å­˜åœ¨\r\n        const profileResult = await ensureProfileExists(mockUser)\r\n        \r\n        if (profileResult.success) {\r\n          console.log('âœ… å¼€å‘æ¨¡å¼ï¼šç”¨æˆ·èµ„æ–™åˆ›å»ºæˆåŠŸ')\r\n        }\r\n        \r\n        // æ¨¡æ‹Ÿæ³¨å†ŒæˆåŠŸ\r\n        return { \r\n          success: true,\r\n          message: 'å¼€å‘æ¨¡å¼ï¼šæ³¨å†ŒæˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰',\r\n          user: mockUser\r\n        }\r\n      }\r\n      \r\n      // çœŸå®ç¯å¢ƒï¼šè°ƒç”¨Supabaseæ³¨å†Œ\r\n      console.log('ğŸ” å°è¯•çœŸå®Supabaseæ³¨å†Œ...')\r\n      const { data, error } = await supabase.auth.signUp({\r\n        email,\r\n        password,\r\n        options: {\r\n          data: { username }\r\n        }\r\n      })\r\n      \r\n      if (error) {\r\n        console.error('Supabaseæ³¨å†Œé”™è¯¯:', error)\r\n        \r\n        // å¦‚æœæ˜¯é…ç½®é—®é¢˜ï¼Œå›é€€åˆ°å¼€å‘æ¨¡å¼\r\n        if (error.status === 400 || error.message.includes('Invalid')) {\r\n          console.warn('Supabaseé…ç½®æ— æ•ˆï¼Œå›é€€åˆ°å¼€å‘æ¨¡å¼')\r\n          \r\n          // å¼€å‘æ¨¡å¼ä¸‹åˆ›å»ºæ¨¡æ‹Ÿç”¨æˆ·èµ„æ–™\r\n          const mockUser = {\r\n            id: 'mock-' + Date.now(),\r\n            email: email,\r\n            user_metadata: { username }\r\n          }\r\n          \r\n          // ç¡®ä¿æ¨¡æ‹Ÿèµ„æ–™å­˜åœ¨\r\n          const profileResult = await ensureProfileExists(mockUser)\r\n          \r\n          if (profileResult.success) {\r\n            console.log('âœ… å¼€å‘æ¨¡å¼ï¼šç”¨æˆ·èµ„æ–™åˆ›å»ºæˆåŠŸ')\r\n          }\r\n          \r\n          return { \r\n            success: true,\r\n            message: 'å¼€å‘æ¨¡å¼ï¼šæ³¨å†ŒæˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰',\r\n            user: mockUser\r\n          }\r\n        }\r\n        \r\n        throw error\r\n      }\r\n      \r\n      console.log('âœ… çœŸå®Supabaseæ³¨å†ŒæˆåŠŸ')\r\n      \r\n      // å¦‚æœæ³¨å†ŒæˆåŠŸä¸”æœ‰ç”¨æˆ·æ•°æ®ï¼Œç¡®ä¿ç”¨æˆ·èµ„æ–™å­˜åœ¨\r\n      if (data.user) {\r\n        console.log('ğŸ‘¤ ç¡®ä¿æ–°æ³¨å†Œç”¨æˆ·çš„èµ„æ–™å­˜åœ¨...')\r\n        const profileResult = await ensureProfileExists(data.user)\r\n        \r\n        if (profileResult.success) {\r\n          console.log('âœ… ç”¨æˆ·èµ„æ–™åˆ›å»º/è·å–æˆåŠŸ')\r\n        } else {\r\n          console.warn('âš ï¸ ç”¨æˆ·èµ„æ–™åˆ›å»ºå¤±è´¥:', profileResult.error)\r\n        }\r\n      }\r\n      \r\n      return { success: true, user: data.user }\r\n    } catch (error: any) {\r\n      console.error('æ³¨å†Œé”™è¯¯:', error)\r\n      return { success: false, error: error.message }\r\n    } finally {\r\n      isLoading.value = false\r\n    }\r\n  }\r\n\r\n  // æ›´æ–°ç”¨æˆ·ç»éªŒå€¼\r\n  const updateExperience = async (points: number) => {\r\n    if (!profile.value) return\r\n    \r\n    try {\r\n      // æ›´æ–°æœ¬åœ°çŠ¶æ€\r\n      profile.value.experience_points += points\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦éœ€è¦å‡çº§\r\n      const currentLevel = profile.value.level\r\n      \r\n      // è®ºå›ç­‰çº§ç»éªŒè¡¨\r\n      const getLevelExpRequired = (level: number) => {\r\n        const expTable = [\r\n          0,    // Lv.1\r\n          50,   // Lv.2 - æ–°æ‰‹\r\n          150,  // Lv.3 - åˆçº§\r\n          300,  // Lv.4 - ä¸­çº§\r\n          500,  // Lv.5 - é«˜çº§\r\n          800,  // Lv.6 - èµ„æ·±\r\n          1200, // Lv.7 - ä¸“å®¶\r\n          1800, // Lv.8 - å¤§å¸ˆ\r\n          2500, // Lv.9 - å®—å¸ˆ\r\n          3500, // Lv.10 - ä¼ å¥‡\r\n          5000, // Lv.11 - å²è¯—\r\n          7000, // Lv.12 - ç¥è¯\r\n          10000 // Lv.13 - è‡³å°Š\r\n        ]\r\n        \r\n        if (level <= 1) return 0\r\n        if (level >= expTable.length) {\r\n          const baseExp = expTable[expTable.length - 1]\r\n          const extraLevels = level - expTable.length + 1\r\n          return baseExp + extraLevels * 2000\r\n        }\r\n        \r\n        return expTable[level - 1]\r\n      }\r\n      \r\n      const newLevelExp = getLevelExpRequired(currentLevel + 1)\r\n      \r\n      if (profile.value.experience_points >= newLevelExp) {\r\n        profile.value.level += 1\r\n        console.log(`ğŸ‰ æ­å–œå‡çº§ï¼å½“å‰ç­‰çº§: Lv.${profile.value.level}`)\r\n      }\r\n      \r\n      // åŒæ­¥åˆ°æ•°æ®åº“\r\n      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL\r\n      const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY\r\n      \r\n      if (!supabaseUrl || !supabaseKey || \r\n          supabaseUrl.includes('default.supabase.co') || \r\n          supabaseKey.includes('default')) {\r\n        // å¼€å‘æ¨¡å¼ä¸‹åªæ›´æ–°æœ¬åœ°çŠ¶æ€\r\n        console.log('å¼€å‘æ¨¡å¼ï¼šç»éªŒå€¼å·²æ›´æ–°åˆ°æœ¬åœ°çŠ¶æ€')\r\n        return\r\n      }\r\n      \r\n      // ç”Ÿäº§ç¯å¢ƒä¸‹åŒæ­¥åˆ°æ•°æ®åº“\r\n      await supabase\r\n        .from('profiles')\r\n        .update({\r\n          experience_points: profile.value.experience_points,\r\n          level: profile.value.level,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq('id', profile.value.id)\r\n      \r\n    } catch (error) {\r\n      console.error('æ›´æ–°ç»éªŒå€¼å¤±è´¥:', error)\r\n      // å¦‚æœæ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œå›æ»šæœ¬åœ°çŠ¶æ€\r\n      profile.value.experience_points -= points\r\n      if (profile.value.level > 1) {\r\n        profile.value.level -= 1\r\n      }\r\n    }\r\n  }\r\n\r\n  // ç™»å‡º\r\n  const signOut = async () => {\r\n    const { error } = await supabase.auth.signOut()\r\n    if (!error) {\r\n      user.value = null\r\n      profile.value = null\r\n    }\r\n  }\r\n\r\n  // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–\r\n  supabase.auth.onAuthStateChange(async (event, session) => {\r\n    console.log('ğŸ” è®¤è¯çŠ¶æ€å˜åŒ–:', event, session?.user?.id)\r\n    \r\n    if (event === 'SIGNED_IN' && session?.user) {\r\n      console.log('âœ… ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œè®¾ç½®ç”¨æˆ·ä¿¡æ¯')\r\n      user.value = session.user\r\n      await fetchProfile()\r\n    } else if (event === 'SIGNED_OUT') {\r\n      console.log('ğŸ‘‹ ç”¨æˆ·ç™»å‡ºï¼Œæ¸…é™¤ç”¨æˆ·ä¿¡æ¯')\r\n      user.value = null\r\n      profile.value = null\r\n    } else if (event === 'TOKEN_REFRESHED') {\r\n      console.log('ğŸ”„ ä»¤ç‰Œå·²åˆ·æ–°')\r\n      // ä¸è¦åœ¨è¿™é‡Œåˆ·æ–°é¡µé¢\r\n    } else if (event === 'USER_UPDATED') {\r\n      console.log('ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°')\r\n      // ä¸è¦åœ¨è¿™é‡Œåˆ·æ–°é¡µé¢\r\n    }\r\n  })\r\n\r\n  return {\r\n    user,\r\n    profile,\r\n    isLoading,\r\n    isAuthenticated,\r\n    currentLevel,\r\n    experiencePoints,\r\n    initializeAuth,\r\n    signIn,\r\n    signUp,\r\n    signOut,\r\n    fetchProfile,\r\n    updateExperience\r\n  }\r\n})"],"names":["ensureProfileExists","user","existingProfile","fetchError","supabase","mockProfile","_a","_b","mockProfiles","username","_c","_d","profileData","newProfile","createError","uniqueUsername","retryProfile","retryError","errorDetails","error","useAuthStore","defineStore","ref","profile","isLoading","isAuthenticated","computed","currentLevel","experiencePoints","initializeAuth","supabaseUrl","session","fetchProfile","supabaseKey","profileResult","_e","signIn","email","password","data","signUp","mockUser","updateExperience","points","newLevelExp","level","expTable","baseExp","extraLevels","signOut","event"],"mappings":"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"}