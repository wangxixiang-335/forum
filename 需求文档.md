《连接者论坛》- 基于Supabase的现代化社区平台 - 项目设计文档

文档信息

• 文档版本: v1.0

• 创建日期: 2025-08-20

• 文档类型: 项目设计文档

• 编写视角: 全栈开发负责人/项目经理视角

• 目标读者: 开发团队、社区运营、项目投资人、技术决策者

项目概述

项目愿景

构建一个以用户创造内容为核心、基于Supabase后端即服务技术栈的现代化、高性能社区论坛。通过引入用户等级与特权体系，激励用户积极参与内容创作与互动，形成一个健康、活跃、具有成长性的高质量社区生态。

核心价值主张

1.  技术驱动的高性能体验：利用Supabase的实时能力，提供无缝的实时互动体验；利用其强大的PostgreSQL数据库，实现复杂查询与数据关系管理。
2.  用户激励与成长体系：通过可视化的等级和特权系统，有效激励用户贡献，提升社区粘性。
3.  丰富的内容互动机制：支持点赞、收藏、评论、转发等多元化互动，促进内容传播与讨论深度。
4. 安全与可扩展的架构：依托Supabase的内置安全机制（RLS），保障用户数据安全，并为未来功能迭代预留充足空间。

系统架构设计 - 基于Supabase的全栈架构

整体架构图 (L.I.G.H.T.模式在社区论坛的具象化)


用户浏览器 (前端)
    ↓
前端框架 (Next.js / React) - 智能化前端 (I)
    ↓
API 路由 (Next.js API Routes) / Supabase客户端 - 最少的后端 (L)
    ↓
Supabase (BaaS) - 可伸缩的数据层 (H)
    ├── PostgreSQL (核心数据库, RLS)
    ├── 实时订阅 (Realtime)
    ├── 认证 (Auth)
    ├── 存储 (Storage for avatars)
    └── 边缘函数 (Edge Functions)


技术架构特点

• Supabase中心化：以Supabase作为整个应用的后端核心，涵盖数据库、认证、实时通信、存储和服务器less函数。

• Monorepo管理：前端应用（Next.js）与Supabase的数据库迁移脚本、Edge Functions函数统一在一个Monorepo中管理，确保环境一致性。

• Serverless优先：复杂业务逻辑通过Supabase Edge Functions实现，无需管理服务器。

• 智能化前端：使用Next.js提供SSR/SSG能力，优化SEO和首屏加载速度；利用SWR或TanStack Query管理服务器状态，提供流畅的用户体验。

• 实时交互：通过Supabase Realtime订阅帖子评论、点赞数的实时变化。

核心数据模型与表结构设计 (H: Hyper-scalable Data)

本平台将充分利用PostgreSQL的关系型能力和Supabase的Row Level Security (RLS)。

关键数据表结构

1.  profiles (用户扩展信息)
    ◦   id (UUID, 主键，与Supabase Auth.users关联)

    ◦   username (文本，唯一，用于@提及)

    ◦   avatar_url (文本，指向Supabase Storage的头像地址)

    ◦   level (整数，用户当前等级)

    ◦   experience_points (整数，用户当前经验值)

    ◦   created_at (时间戳)

2.  posts (帖子表)
    ◦   id (UUID, 主键)

    ◦   user_id (UUID, 外键 -> profiles.id)

    ◦   title (文本)

    ◦   content (文本，支持Markdown)

    ◦   tags (文本数组，用于分类和搜索)

    ◦   like_count (整数，聚合值，用于排序)

    ◦   comment_count (整数，聚合值)

    ◦   view_count (整数)

    ◦   is_pinned (布尔值，版主可置顶)

    ◦   created_at (时间戳)

3.  comments (评论表)
    ◦   id (UUID, 主键)

    ◦   post_id (UUID, 外键 -> posts.id)

    ◦   user_id (UUID, 外键 -> profiles.id)

    ◦   content (文本)

    ◦   parent_id (UUID, 外键 -> comments.id, 用于回复评论，实现嵌套结构)

    ◦   like_count (整数)

    ◦   is_pinned (布尔值，楼主或高等级用户可置顶)

    ◦   created_at (时间戳)

4.  interactions (互动表，用于记录点赞、收藏、转发)
    ◦   id (UUID, 主键)

    ◦   user_id (UUID, 外键 -> profiles.id)

    ◦   target_type (枚举: 'post', 'comment')

    ◦   target_id (UUID, 对应帖子或评论的ID)

    ◦   interaction_type (枚举: 'like', 'bookmark', 'share')

    ◦   created_at (时间戳)

    ◦   (唯一索引： user_id, target_type, target_id, interaction_type 防止重复操作)

数据层关键实践

• RLS（行级安全）：为每张表启用RLS，并创建精细的策略（Policies）。例如：

    ◦   posts表：所有人可读（SELECT），仅登录用户可插入（INSERT），仅帖子作者或管理员可更新/删除（UPDATE/DELETE）。

    ◦   interactions表：用户只能查询（SELECT）自己的互动记录，只能插入（INSERT）或删除（DELETE）自己的互动，不能修改他人的。

• 实时订阅：对posts表的like_count, comment_count和comments表的新增进行实时订阅，前端即时更新。

• 数据库函数：使用PostgreSQL函数处理复杂操作，如“点赞”操作：在interactions表插入记录的同时，使用函数原子性地更新posts.like_count，避免数据不一致。

用户等级与特权系统架构 (T: Templated Features)

等级经验值模型

• 经验值获取：

    ◦   发布帖子：+10 EXP

    ◦   发布评论：+3 EXP

    ◦   帖子被点赞：+2 EXP (每日有上限)

    ◦   评论被点赞：+1 EXP (每日有上限)

    ◦   帖子被收藏/转发：+1 EXP

• 等级升级公式： 采用渐进式，例如 Level N 所需经验 = 100 * N^1.5。

特权系统设计 (基于等级的模板化特性)

等级区间 特权描述 (模板化功能)

Lv. 1-3 (新手) 基础特权：正常发帖、评论、点赞、收藏。用户名和评论显示为默认样式。

Lv. 4-6 (活跃者) 样式特权：用户名旁边显示特殊徽章。可设置评论字体为粗体或斜体。

Lv. 7-9 (贡献者) 色彩特权：用户名和评论背景可设置为预定义的柔和颜色（如浅蓝、浅绿）。

Lv. 10+ (资深/版主) 管理特权：可置顶自己帖子下的评论（置顶/置底）。拥有更多高级色彩和边框特效。具备举报处理权限。

特权实现：在用户发布评论或其信息被渲染时，前端根据profiles.level字段，动态应用对应的CSS类名，实现颜色和特效。

用户界面设计理念 (I: Intelligent Frontend)

设计原则

1.  内容优先：界面布局清晰，突出帖子内容本身，减少不必要的视觉干扰。
2.  实时反馈：点赞、评论等操作提供即时视觉反馈，并通过Supabase Realtime实时更新计数。
3.  角色化体验：高等级用户的特权（如彩色ID、置顶按钮）在界面中清晰可见，增强荣誉感。
4.  响应式设计：完美适配从手机到桌面的各种屏幕尺寸。

核心页面设计

1.  论坛首页
    ◦   布局：顶部为导航栏和发帖按钮。主体为帖子流，支持按“最新发布”、“最多点赞”、“最新回复”等排序。

    ◦   功能：每个帖子卡片预览显示标题、作者（带等级徽章）、摘要、标签、互动数据（实时更新）。

2.  帖子详情页
    ◦   布局：顶部为帖子全文。中部为评论列表，支持嵌套回复。

    ◦   功能：点赞、收藏、转发按钮。评论框。楼主和高等级用户的评论置顶/置底操作按钮。实时显示新评论。

3.  用户个人中心
    ◦   布局：展示用户头像、用户名、等级、经验进度条、所获特权列表。

    ◦   功能：管理“我的帖子”、“我的评论”、“我的收藏”。

性能优化策略 (跨域护栏: 可观测性与成本控制)

1.  数据库优化 (H)
    ◦   索引优化：为所有外键（user_id, post_id）、常用查询字段（created_at, like_count）和组合查询（(tags, created_at)) 创建索引。

    ◦   查询优化：使用分页查询帖子列表，避免一次性拉取大量数据。使用count(*)估计总数，而非精确计算。

2.  前端优化 (I)
    ◦   静态生成（SSG）：对不常变化的页面（如关于页、规则页）进行静态生成。

    ◦   服务端渲染（SSR）：对帖子详情页使用SSR，利于SEO和首屏加载。

    ◦   图片优化：使用Next.js Image组件自动优化头像和帖子内的图片。

3.  Supabase 成本控制
    ◦   监控：利用Supabase仪表板监控API调用次数、数据库空间使用情况。

    ◦   缓存：对频繁读取且变化不频繁的数据（如用户等级信息）在前端进行缓存。

安全与权限设计 (跨域护栏: 安全与合规)

1.  数据安全与隐私 (基于Supabase RLS)
    ◦   RLS策略：如前所述，为每张表编写严格的RLS策略，确保用户只能访问和操作授权数据。

    ◦   认证：使用Supabase Auth，支持邮箱/密码、第三方OAuth（如GitHub、Google）等多种登录方式。

2.  内容安全
    ◦   关键词过滤：在Edge Function中实现发布帖子/评论时的敏感词过滤。

    ◦   举报机制：用户可举报违规内容，由管理员处理。

项目进度与里程碑

阶段一：核心功能MVP (约 2个月)

1.  Supabase项目搭建与基础表设计：完成数据库初始化、RLS策略配置。
2.  用户系统：实现登录、注册、个人信息修改。
3.  帖子与评论CRUD：实现发帖、编辑、删除、评论功能。
4.  基础互动：实现点赞功能，并在前端实现实时计数更新。

阶段二：等级系统与社区深化 (约 1.5个月)

1.  经验值与等级系统：实现经验计算、升级逻辑和特权应用。
2.  收藏与转发功能：完善互动体系。
3.  用户个人中心：开发完整的个人主页。
4.  管理员后台：基础的内容管理界面。

阶段三：打磨与上线 (约 1个月)

1.  性能优化与测试：进行压力测试、安全审计。
2.  用户体验优化：完善UI/UX，增加动画和加载状态。
3.  上线部署：部署到Vercel等平台，连接生产环境Supabase项目。
4.  运营准备：制定社区准则，准备初始内容。

成功指标与评估

技术指标

• 页面加载时间：首屏加载 < 1.5秒 (P90)。

• 实时更新延迟：< 100ms。

• API响应时间：< 200ms (P90)。

业务指标

• 用户注册增长率：目标周均 > 5%。

• 用户互动率：日活用户中产生互动（发帖、评论、点赞）的比例 > 30%。

• 内容生产量：日均新帖数 > 20，日均新评论数 > 100。

用户体验指标

• 用户满意度：通过问卷或NPS评分，目标 > 4.0/5.0。

• 等级系统参与度：> 60%的活跃用户有意提升等级。

总结
《连接者论坛》项目充分利用了Supabase的现代化BaaS能力，极大地简化了后端开发复杂度，使团队能专注于构建核心业务逻辑和用户体验。通过将L.I.G.H.T.架构思想应用于社区场景，我们旨在构建一个不仅功能丰富、性能优异，而且具备良好可扩展性和安全性的社区平台。其清晰的用户成长路径将成为驱动社区活跃与健康发展的核心引擎。

